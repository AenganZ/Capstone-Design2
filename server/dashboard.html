<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì‹¤ì¢…ì ì•Œë¦¼ ì‹œìŠ¤í…œ ê´€ë¦¬ì</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Noto Sans KR', -apple-system, BlinkMacSystemFont, sans-serif;
            background: #f8fafc;
            color: #334155;
        }
        
        .header {
            background: linear-gradient(135deg, #1e40af, #3b82f6);
            color: white;
            padding: 1rem 2rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            height: 70px;
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            height: 100%;
        }
        
        .header h1 {
            font-size: 1.5rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #10b981;
            animation: pulse 2s infinite;
        }
        
        .status-indicator.disconnected {
            background: #ef4444;
        }
        
        .header-stats {
            display: flex;
            gap: 2rem;
            font-size: 0.9rem;
        }
        
        .stat-item {
            text-align: center;
        }
        
        .stat-value {
            font-size: 1.2rem;
            font-weight: 700;
            display: block;
        }
        
        .stat-label {
            font-size: 0.8rem;
            opacity: 0.9;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .main-container {
            display: flex;
            height: calc(100vh - 70px);
            padding-top: 0;
            margin-top: 70px;
        }
        
        .sidebar {
            width: 400px;
            background: white;
            border-left: 1px solid #e2e8f0;
            overflow-y: auto;
            flex-shrink: 0;
            order: 2;
        }
        
        .tab-container {
            display: flex;
            border-bottom: 1px solid #e2e8f0;
            background: white;
        }

        /* ê°€ë¡œ ìŠ¤í¬ë¡¤ë°” ìŠ¤íƒ€ì¼ë§ (Chrome, Safari) */
        .tab-container::-webkit-scrollbar {
            height: 4px;
        }

        .tab-container::-webkit-scrollbar-track {
            background: #f1f1f1;
        }

        .tab-container::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 4px;
        }

        .tab-container::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
        
        .tab-button {
            flex: 1;
            padding: 12px 10px;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 0.8rem;
            font-weight: 500;
            color: #64748b;
            transition: all 0.2s;
            white-space: nowrap; 
        }
        
        .tab-button.active {
            color: #3b82f6;
            border-bottom: 2px solid #3b82f6;
            background: #f8fafc;
        }
        
        .tab-button:hover {
            background: #f1f5f9;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .content-area {
            flex: 1;
            height: 100%;
            order: 1;
            position: relative;
        }
        
        .map-placeholder {
            width: 100%;
            height: 100%;
            background: #f0f0f0;
            position: relative;
        }
        
        #map {
            width: 100%;
            height: 100%;
            display: none;
        }
        
        .map-overlay {
            position: absolute;
            top: 20px;
            left: 20px;
            z-index: 100;
            display: flex;
            flex-direction: column;
            gap: 15px;
            pointer-events: none;
        }
        
        .map-overlay > * {
            pointer-events: auto;
        }
        
        .map-status-panel {
            background: rgba(255, 255, 255, 0.95);
            padding: 12px 15px;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
            font-size: 0.875rem;
        }
        
        .api-key-setup {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 2rem;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            max-width: 400px;
            text-align: center;
            z-index: 10;
        }
        
        .api-key-setup h3 {
            color: #1e293b;
            margin-bottom: 1rem;
        }
        
        .api-key-setup code {
            background: #f1f5f9;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-family: monospace;
        }
        
        .test-buttons {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .test-btn {
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            padding: 8px 16px;
            cursor: pointer;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            font-size: 12px;
            font-weight: 500;
            transition: all 0.2s;
            min-width: 120px;
        }
        
        .test-btn:hover {
            background: #f8fafc;
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }
        
        .test-btn.loading {
            opacity: 0.7;
            cursor: not-allowed;
        }
        
        .sidebar-section {
            padding: 1.5rem;
            border-bottom: 1px solid #e2e8f0;
        }
        
        .section-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 1rem;
            color: #1e293b;
        }
        
        .person-list {
            max-height: 400px;
            overflow-y: auto;
        }
        
        .person-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 1rem;
            margin-bottom: 0.75rem;
            background: #f8fafc;
            border-radius: 8px;
            border-left: 4px solid #e2e8f0;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .person-item:hover {
            background: #f1f5f9;
            transform: translateX(2px);
        }
        
        .person-item.high-priority {
            border-left-color: #ef4444;
            background: #fef2f2;
        }
        
        .person-item.selected {
            border-left-color: #3b82f6;
            background: #eff6ff;
            box-shadow: 0 2px 4px rgba(59, 130, 246, 0.1);
        }
        
        .person-item.new {
            animation: highlight 3s ease-out;
            border-left-color: #10b981;
            background: #f0fdf4;
        }
        
        @keyframes highlight {
            0% { box-shadow: 0 0 20px rgba(16, 185, 129, 0.5); }
            100% { box-shadow: none; }
        }
        
        .person-marker {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
            flex-shrink: 0;
            font-size: 0.8rem;
        }
        
        .person-marker.high {
            background: linear-gradient(135deg, #ef4444, #dc2626);
        }
        
        .person-marker.medium {
            background: linear-gradient(135deg, #f59e0b, #d97706);
        }
        
        .person-info {
            flex: 1;
            min-width: 0;
        }
        
        .person-name {
            font-weight: 600;
            color: #1e293b;
            margin-bottom: 0.25rem;
        }
        
        .person-details {
            font-size: 0.875rem;
            color: #64748b;
            line-height: 1.4;
        }
        
        .risk-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 0.25rem;
            margin-top: 0.5rem;
        }
        
        .risk-tag {
            background: #ef4444;
            color: white;
            padding: 0.125rem 0.5rem;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: 500;
        }
        
        .person-detail-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 2000;
        }
        
        .person-detail-content {
            background: white;
            border-radius: 12px;
            padding: 2rem;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            margin: 2rem;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
        }
        
        .person-photo {
            width: 150px;
            height: 150px;
            border-radius: 8px;
            object-fit: cover;
            border: 2px solid #e5e7eb;
            margin-bottom: 1rem;
        }
        
        .person-photo.placeholder {
            background: #f3f4f6;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #9ca3af;
            font-size: 3rem;
        }
        
        .detail-section {
            margin-bottom: 1.5rem;
        }
        
        .detail-section h4 {
            color: #1f2937;
            margin-bottom: 0.5rem;
            font-size: 1.1rem;
        }
        
        .detail-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 1rem;
        }
        
        .detail-item {
            background: #f9fafb;
            padding: 0.75rem;
            border-radius: 6px;
            border-left: 3px solid #3b82f6;
        }
        
        .detail-label {
            font-size: 0.875rem;
            color: #6b7280;
            margin-bottom: 0.25rem;
        }
        
        .detail-value {
            font-weight: 500;
            color: #1f2937;
        }
        
        .feature-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-top: 0.5rem;
        }
        
        .feature-tag {
            background: #3b82f6;
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 16px;
            font-size: 0.75rem;
        }
        
        .close-modal {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: #f3f4f6;
            border: none;
            border-radius: 50%;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 1.2rem;
        }
        
        .notification-panel {
            background: #f8fafc;
        }
        
        .notification-form {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }
        
        .form-label {
            font-weight: 500;
            color: #374151;
            font-size: 0.9rem;
        }
        
        .form-input, .form-select {
            padding: 0.75rem;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 0.875rem;
        }
        
        .form-input:focus, .form-select:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        
        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 6px;
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .btn:hover {
            opacity: 0.9;
            transform: translateY(-1px);
        }

        .btn-primary {
            background: #3b82f6;
            color: white;
        }
        
        .btn-primary:hover {
            background: #2563eb;
        }
        
        .btn-secondary {
            background: #6b7280;
            color: white;
        }
        
        .btn-secondary:hover {
            background: #4b5563;
        }
        
        .activity-log {
            max-height: 300px;
            overflow-y: auto;
        }
        
        .activity-item {
            padding: 0.75rem;
            border-bottom: 1px solid #e2e8f0;
            font-size: 0.875rem;
        }
        
        .activity-item:last-child {
            border-bottom: none;
        }
        
        .activity-time {
            color: #64748b;
            font-size: 0.75rem;
        }
        
        .activity-content {
            color: #1e293b;
            margin-top: 0.25rem;
        }
        
        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            padding: 2rem;
            color: #6b7280;
        }
        
        .spinner {
            width: 20px;
            height: 20px;
            border: 2px solid #e5e7eb;
            border-top: 2px solid #3b82f6;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .toast {
            position: fixed;
            top: 90px;
            right: 20px;
            background: white;
            border-left: 4px solid #10b981;
            padding: 1rem 1.5rem;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            z-index: 1100;
            transform: translateX(100%);
            transition: transform 0.3s ease;
            max-width: 300px;
        }
        
        .toast.show {
            transform: translateX(0);
        }
        
        .toast.error {
            border-left-color: #ef4444;
        }
        
        .result-display {
            margin-top: 1rem;
            padding: 1rem;
            background: #f8fafc;
            border-radius: 6px;
            border: 1px solid #e2e8f0;
            font-family: monospace;
            font-size: 0.875rem;
            white-space: pre-wrap;
            max-height: 200px;
            overflow-y: auto;
        }

        .heatmap-controls {
            background: rgba(255, 255, 255, 0.95);
            padding: 10px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            margin-bottom: 10px;
        }

        .heatmap-controls label {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.8rem;
            margin-bottom: 5px;
        }

        .heatmap-controls input[type="checkbox"] {
            margin: 0;
        }

        .heatmap-controls input[type="range"] {
            width: 100%;
            margin-top: 5px;
            -webkit-appearance: none;
            height: 6px;
            border-radius: 3px;
            background: #ddd;
            outline: none;
        }

        .heatmap-controls input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: #3b82f6;
            cursor: pointer;
        }

        .heatmap-controls input[type="range"]::-moz-range-thumb {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: #3b82f6;
            cursor: pointer;
            border: none;
        }

        .opacity-label {
            font-size: 0.7rem;
            color: #64748b;
            text-align: center;
            margin-top: 2px;
        }

        .driver-status {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-left: 8px;
        }

        .driver-status.online {
            background: #10b981;
            animation: pulse 2s infinite;
        }

        .driver-status.offline {
            background: #6b7280;
        }

        .cctv-video-player {
            background: #000;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            color: white;
            margin-top: 15px;
            position: relative;
        }

        .cctv-video-frame {
            width: 100%;
            height: 200px;
            background: #111;
            border: 2px solid #333;
            border-radius: 8px;
            position: relative;
            overflow: hidden;
        }

        .video-placeholder {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
        }

        .cctv-controls {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 10px;
        }

        .cctv-btn {
            background: rgba(255,255,255,0.2);
            border: 1px solid rgba(255,255,255,0.3);
            color: white;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 0.8rem;
            cursor: pointer;
        }

        .cctv-btn:hover {
            background: rgba(255,255,255,0.3);
        }

        .cctv-status-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            font-size: 0.8rem;
        }

        .cctv-quality {
            background: rgba(255,255,255,0.1);
            padding: 2px 8px;
            border-radius: 4px;
        }

        .live-indicator {
            color: #ef4444;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .live-dot {
            width: 8px;
            height: 8px;
            background: #ef4444;
            border-radius: 50%;
            animation: pulse 1s infinite;
        }
        
        .server-status {
            background: rgba(255, 255, 255, 0.95);
            padding: 10px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            margin-bottom: 10px;
        }

        .server-status h4 {
            margin: 0 0 8px 0;
            color: #1e293b;
            font-size: 0.9rem;
        }

        .server-item {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 5px;
            font-size: 0.8rem;
        }

        .server-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
        }

        .server-indicator.online {
            background: #10b981;
        }

        .server-indicator.offline {
            background: #ef4444;
        }
        
        @media (max-width: 768px) {
            .main-container {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
                height: 40vh;
            }
            
            .content-area {
                height: 60vh;
            }
            
            .header-stats {
                display: none;
            }
        }
        .person-card {
            padding: 1rem;
            margin-bottom: 0.75rem;
            background: white;
            border-radius: 8px;
            border: 1px solid #e5e7eb;
        }

        .person-badge {
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            background: #f3f4f6;
            color: #374151;
            font-size: 0.875rem;
            display: inline-block;
        }

        .category-badge {
            background: #dbeafe;
            color: #1e40af;
            font-weight: 600;
        }

        .stats-row {
            display: flex;
            gap: 1rem;
        }

        .stat-card {
            flex: 1;
            background: white;
            padding: 1rem;
            border-radius: 8px;
            border: 1px solid #e5e7eb;
            text-align: center;
        }

        .detail-section {
            margin-bottom: 1.5rem;
        }

        .detail-section h4 {
            font-size: 1rem;
            font-weight: 600;
            color: #374151;
            margin-bottom: 0.75rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid #e5e7eb;
        }

        .detail-row {
            display: flex;
            justify-content: space-between;
            padding: 0.5rem 0;
            border-bottom: 1px solid #f3f4f6;
        }

        .detail-label {
            font-weight: 500;
            color: #6b7280;
        }

        .detail-value {
            font-weight: 500;
            color: #1f2937;
        }

        .risk-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-top: 0.5rem;
        }

        .risk-tag {
            background: #fee2e2;
            color: #991b1b;
            padding: 0.25rem 0.75rem;
            border-radius: 16px;
            font-size: 0.75rem;
            font-weight: 600;
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="header-content">
            <h1>
                <span class="status-indicator" id="connectionStatus"></span>
                ì‹¤ì¢…ì ì•Œë¦¼ ì‹œìŠ¤í…œ ê´€ë¦¬ì
            </h1>
            <div class="header-stats">
                <div class="stat-item">
                    <span class="stat-value" id="totalActive">0</span>
                    <span class="stat-label">í™œì„± ì‹¤ì¢…ì</span>
                </div>
                <div class="stat-item">
                    <span class="stat-value" id="highPriority">0</span>
                    <span class="stat-label">ê³ ìœ„í—˜êµ°</span>
                </div>
                <div class="stat-item">
                    <span class="stat-value" id="onlineDrivers">0</span>
                    <span class="stat-label">ì˜¨ë¼ì¸ ê¸°ì‚¬</span>
                </div>
                <div class="stat-item">
                    <span class="stat-value" id="firebaseStatus">-</span>
                    <span class="stat-label">Firebase</span>
                </div>
            </div>
        </div>
    </div>
    
    <div class="main-container">
        <div class="sidebar">
            <div class="tab-container">
                <button class="tab-button active" onclick="switchTab('missing')">ì‹¤ì¢…ì</button>
                <button class="tab-button" onclick="switchTab('drivers')">ê¸°ì‚¬ê´€ë¦¬</button>
                <button class="tab-button" onclick="switchTab('cctv')">CCTV</button>
                <button class="tab-button" onclick="switchTab('alert')">ì•Œë¦¼</button>
                <button class="tab-button" onclick="switchTab('reports')">ì‹¤ì¢…ì ì‹ ê³ </button>
            </div>
            <div id="missing-tab" class="tab-content active">
                <div class="sidebar-section">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                        <h2 class="section-title" style="margin-bottom: 0;">ì‹¤ì¢…ì ëª©ë¡</h2>
                        <div style="display: flex; gap: 0.5rem;">
                            <button class="test-btn" style="padding: 4px 8px; font-size: 0.7rem;" onclick="admin.toggleAllPersons(true)">ì „ì²´ í‘œì‹œ</button>
                            <button class="test-btn" style="padding: 4px 8px; font-size: 0.7rem;" onclick="admin.toggleAllPersons(false)">ì „ì²´ ìˆ¨ê¹€</button>
                        </div>
                    </div>
                    <div class="form-group" style="margin-bottom: 1rem;">
                        <input type="text" 
                            class="form-input" 
                            id="missingPersonSearch" 
                            placeholder="ì´ë¦„ìœ¼ë¡œ ê²€ìƒ‰..." 
                            onkeyup="searchMissingPersons()"
                            style="width: 100%; padding: 0.5rem; border: 1px solid #d1d5db; border-radius: 6px;">
                    </div>
                    <div class="person-list" id="personList">
                        <div class="loading">
                            <div class="spinner"></div>
                            ì‹¤ì¢…ì ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...
                        </div>
                    </div>
                </div>
                
                <div class="sidebar-section">
                    <h2 class="section-title">ì‹¤ì‹œê°„ í™œë™</h2>
                    <div class="activity-log" id="activityLog">
                        <div class="activity-item">
                            <div class="activity-time">ì‹œìŠ¤í…œ ì‹œì‘</div>
                            <div class="activity-content">ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§ì„ ì‹œì‘í•©ë‹ˆë‹¤</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div id="drivers-tab" class="tab-content">
                <div class="sidebar-section">
                    <h2 class="section-title">ë“±ë¡ëœ ê¸°ì‚¬ (ì‹¤ì‹œê°„)</h2>
                    <div class="person-list" id="driverList">
                        <div style="text-align: center; padding: 2rem; color: #9ca3af;">
                            ë“±ë¡ëœ ê¸°ì‚¬ê°€ ì—†ìŠµë‹ˆë‹¤.
                        </div>
                    </div>
                </div>
                
                <div class="sidebar-section">
                    <h2 class="section-title">ê¸°ì‚¬ ë“±ë¡</h2>
                    <form class="notification-form" id="driverForm">
                        <div class="form-group">
                            <label class="form-label">ê¸°ì‚¬ ì´ë¦„</label>
                            <input type="text" class="form-input" id="driverName" placeholder="ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">ì°¨ëŸ‰ ë²ˆí˜¸</label>
                            <input type="text" class="form-input" id="driverVehicle" placeholder="12ê°€3456" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">ì—°ë½ì²˜</label>
                            <input type="tel" class="form-input" id="driverPhone" placeholder="010-1234-5678" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">ì—…ì¢…</label>
                            <select class="form-select" id="driverType" required>
                                <option value="">ì—…ì¢… ì„ íƒ</option>
                                <option value="taxi">íƒì‹œ</option>
                                <option value="delivery">ë°°ë‹¬</option>
                            </select>
                        </div>
                        <button type="submit" class="btn btn-primary">ê¸°ì‚¬ ë“±ë¡</button>
                    </form>
                </div>
                
                <div class="sidebar-section">
                    <h2 class="section-title">ì„ íƒëœ ê¸°ì‚¬ì—ê²Œ ë©”ì‹œì§€</h2>
                    <div class="notification-form">
                        <div class="form-group">
                            <label class="form-label">ë©”ì‹œì§€ ë‚´ìš©</label>
                            <textarea class="form-input" id="messageContent" rows="3" placeholder="ê¸°ì‚¬ì—ê²Œ ë³´ë‚¼ ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”..."></textarea>
                        </div>
                        <button type="button" class="btn btn-primary" onclick="sendDriverMessage()">ë©”ì‹œì§€ ì „ì†¡</button>
                    </div>
                </div>
            </div>
            
            <div id="cctv-tab" class="tab-content">
                <div class="sidebar-section">
                    <h2 class="section-title">ì£¼ë³€ CCTV ëª©ë¡</h2>
                    <div class="form-group">
                        <label class="form-label">ê²€ìƒ‰ ë°˜ê²½</label>
                        <select class="form-select" id="cctvRadius">
                            <option value="500">500m</option>
                            <option value="1000" selected>1km</option>
                            <option value="2000">2km</option>
                            <option value="5000">5km</option>
                        </select>
                    </div>
                    <button class="btn btn-secondary" onclick="searchNearbyCCTVs()">ì£¼ë³€ CCTV ê²€ìƒ‰</button>
                    
                    <div class="person-list" id="cctvList" style="margin-top: 1rem;">
                        <div style="text-align: center; padding: 2rem; color: #9ca3af;">
                            ì‹¤ì¢…ìë¥¼ ì„ íƒí•˜ê³  CCTVë¥¼ ê²€ìƒ‰í•˜ì„¸ìš”.
                        </div>
                    </div>
                </div>
                
                <div class="sidebar-section">
                    <h2 class="section-title">CCTV ì‹¤ì‹œê°„ ì˜ìƒ</h2>
                    <div id="cctvDetail" style="padding: 1rem; background: #f8fafc; border-radius: 8px; min-height: 100px;">
                        <p style="text-align: center; color: #9ca3af;">CCTVë¥¼ ì„ íƒí•˜ë©´ ì‹¤ì‹œê°„ ì˜ìƒì´ í‘œì‹œë©ë‹ˆë‹¤.</p>
                    </div>
                </div>
            </div>
            
            <div id="alert-tab" class="tab-content">
                <div class="sidebar-section notification-panel">
                    <h2 class="section-title">ì‹¤ì¢…ìë³„ ë§ì¶¤ ì•Œë¦¼ ì „ì†¡</h2>
                    <form class="notification-form" id="notificationForm">
                        <div class="form-group">
                            <label class="form-label">ì‹¤ì¢…ì ì„ íƒ</label>
                            <select class="form-select" id="personSelect">
                                <option value="">ì‹¤ì¢…ìë¥¼ ì„ íƒí•˜ì„¸ìš”</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">ìˆ˜ìƒ‰ ë²”ìœ„ ì •ë³´</label>
                            <div id="searchRadiusInfo" style="padding: 10px; background: #f0f9ff; border-radius: 6px; font-size: 0.8rem; color: #1e40af;">
                                ì‹¤ì¢…ìë¥¼ ì„ íƒí•˜ë©´ ì—°êµ¬ ê¸°ë°˜ ìˆ˜ìƒ‰ ë²”ìœ„ê°€ í‘œì‹œë©ë‹ˆë‹¤.
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">ë²”ìœ„ ë‚´ ê¸°ì‚¬ í˜„í™©</label>
                            <div id="driversInRange" style="padding: 10px; background: #f0fdf4; border-radius: 6px; font-size: 0.8rem; color: #15803d;">
                                ì‹¤ì¢…ìë¥¼ ì„ íƒí•˜ë©´ ë²”ìœ„ ë‚´ ê¸°ì‚¬ ìˆ˜ê°€ í‘œì‹œë©ë‹ˆë‹¤.
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">ì•Œë¦¼ ë°©ì‹</label>
                            <select class="form-select" id="notificationType">
                                <option value="smart">ìŠ¤ë§ˆíŠ¸ ì „ì†¡ (ë²”ìœ„ ë‚´ ê¸°ì‚¬)</option>
                                <option value="test">í…ŒìŠ¤íŠ¸ ì „ì†¡</option>
                                <option value="all">ì „ì²´ ì „ì†¡</option>
                            </select>
                        </div>
                        <button type="submit" class="btn btn-primary">ì•Œë¦¼ ì „ì†¡</button>
                    </form>
                    <div id="notificationResult"></div>
                </div>
            </div>
            <div id="reports-tab" class="tab-content">
                <div class="sidebar-section">
                    <h2 class="section-title">ëŒ€ê¸° ì¤‘ì¸ ì‹ ê³  ëª©ë¡</h2>
                    <div class="stats-row" style="margin-bottom: 1rem;">
                        <div class="stat-card">
                            <div class="stat-value" id="pendingReportsCount">0</div>
                            <div class="stat-label">ëŒ€ê¸° ì¤‘</div>
                        </div>
                    </div>
                    <button class="btn btn-secondary" onclick="loadPendingReports()" style="margin-bottom: 1rem;">
                        ëª©ë¡ ìƒˆë¡œê³ ì¹¨
                    </button>
                    
                    <div class="person-list" id="pendingReportsList">
                        <div style="text-align: center; padding: 2rem; color: #9ca3af;">
                            ëŒ€ê¸° ì¤‘ì¸ ì‹ ê³ ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...
                        </div>
                    </div>
                </div>
                
                <div class="sidebar-section">
                    <h2 class="section-title">ìŠ¹ì¸ëœ ì‹¤ì¢…ì ê´€ë¦¬</h2>
                    <div class="form-group">
                        <label class="form-label">ì‹¤ì¢…ì ê²€ìƒ‰</label>
                        <input type="text" class="form-input" id="approvedPersonSearch" 
                               placeholder="ì´ë¦„ìœ¼ë¡œ ê²€ìƒ‰..." onkeyup="searchApprovedPersons()">
                    </div>
                    
                    <div class="person-list" id="approvedPersonsList" style="max-height: 400px; overflow-y: auto;">
                        <div style="text-align: center; padding: 2rem; color: #9ca3af;">
                            ìŠ¹ì¸ëœ ì‹¤ì¢…ì ëª©ë¡
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="content-area">
            <div class="map-placeholder">
                <div style="position: absolute; top: 20px; left: 20px; z-index: 200;">
                    <div class="test-buttons">
                        <button class="test-btn" onclick="testAPI()">API í…ŒìŠ¤íŠ¸</button>
                        <button class="test-btn" onclick="testFirebase()">Firebase í…ŒìŠ¤íŠ¸</button>
                        <button class="test-btn" onclick="testTokens()">í† í° ëª©ë¡</button>
                        <button class="test-btn" onclick="testStatistics()">í†µê³„ í™•ì¸</button>
                        <button class="test-btn" onclick="createTestToken()">í…ŒìŠ¤íŠ¸ í† í° ìƒì„±</button>
                        <button class="test-btn" onclick="forceUpdate()">ìˆ˜ë™ ì—…ë°ì´íŠ¸</button>
                        <button class="test-btn" onclick="initKakaoMap()">ì¹´ì¹´ì˜¤ë§µ ì´ˆê¸°í™”</button>
                        <button class="test-btn" onclick="checkNERServer()">NER ì„œë²„ í™•ì¸</button>
                    </div>
                </div>
                
                <div class="map-overlay" id="mapOverlay" style="display: none; top: 20px; right: 20px; left: auto;">
                    <div class="server-status">
                        <h4>ì„œë²„ ìƒíƒœ</h4>
                        <div class="server-item">
                            <span class="server-indicator" id="mainServerStatus"></span>
                            <span>ë©”ì¸ ì„œë²„ (í¬íŠ¸ 8001)</span>
                        </div>
                        <div class="server-item">
                            <span class="server-indicator" id="nerServerStatus"></span>
                            <span>NER ì„œë²„ (í¬íŠ¸ 8000)</span>
                        </div>
                        <div class="server-item">
                            <span class="server-indicator" id="firebaseServerStatus"></span>
                            <span>Firebase</span>
                        </div>
                    </div>
                    
                    <div class="heatmap-controls">
                        <h4 style="margin: 0 0 8px 0; color: #1e293b; font-size: 0.9rem;">ìˆ˜ìƒ‰ ë²”ìœ„ íˆíŠ¸ë§µ</h4>
                        <label>
                            <input type="checkbox" id="showHeatmap" checked onchange="admin.toggleHeatmap()">
                            ìˆ˜ìƒ‰ ë²”ìœ„ í‘œì‹œ
                        </label>
                        <label>
                            <input type="checkbox" id="showDrivers" checked onchange="admin.toggleDriverVisibility()">
                            ê¸°ì‚¬ ìœ„ì¹˜ í‘œì‹œ
                        </label>
                        <div style="margin-top: 8px;">
                            <label style="font-size: 0.8rem; color: #64748b; display: block; margin-bottom: 4px;">íˆíŠ¸ë§µ íˆ¬ëª…ë„ (max 70%)</label>
                            <input type="range" id="heatmapOpacity" min="0.01" max="0.7" step="0.01" value="0.15" onchange="admin.updateHeatmapOpacity()">
                            <div id="opacityValue" class="opacity-label">15%</div>
                        </div>
                    </div>
                    <div class="map-status-panel">
                        <h4 style="margin: 0 0 8px 0; color: #1e293b; font-size: 0.9rem;">ì§€ë„ ìƒíƒœ</h4>
                        <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 5px;">
                            <span class="status-indicator" id="mapStatus"></span>
                            <span id="mapStatusText" style="font-size: 0.8rem;">ì§€ë„ ì¤€ë¹„ ì™„ë£Œ</span>
                        </div>
                        <div style="font-size: 0.75rem; color: #64748b;" id="markerCount">ë§ˆì»¤: 0ê°œ</div>
                        <div style="font-size: 0.75rem; color: #64748b;" id="driverCount">ì˜¨ë¼ì¸ ê¸°ì‚¬: 0ëª…</div>
                    </div>
                </div>
                
                <div id="map"></div>
                
                <div class="api-key-setup" id="apiKeySetup">
                    <h3>ì¹´ì¹´ì˜¤ ì§€ë„ ë¡œë”© ì¤‘...</h3>
                    <p>ì¹´ì¹´ì˜¤ ì§€ë„ë¥¼ ì´ˆê¸°í™”í•˜ê³  ìˆìŠµë‹ˆë‹¤. ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”.</p>
                    <div style="margin-top: 1rem; text-align: center;">
                        <div class="spinner"></div>
                    </div>
                </div>
                
                <div id="testResults" class="result-display" style="display: none;"></div>
            </div>
        </div>
    </div>

    <div class="person-detail-modal" id="personDetailModal">
        <div class="person-detail-content">
            <button class="close-modal" onclick="closePersonDetail()">Ã—</button>
            <div id="personDetailContent"></div>
        </div>
    </div>

    <script src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=YOUR_KAKAO_API_KEY&libraries=services"></script>
    <script>
        const API_BASE_URL = 'http://localhost:8001';
        const NER_API_URL = 'http://localhost:8000';
        
        function switchTab(tabName) {
            document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            document.querySelector(`[onclick="switchTab('${tabName}')"]`).classList.add('active');
            document.getElementById(`${tabName}-tab`).classList.add('active');
            
            // ì‹¤ì¢…ì ì‹ ê³  íƒ­ í´ë¦­ ì‹œ ë°ì´í„° ë¡œë“œ
            if (tabName === 'reports') {
                loadPendingReports();
                loadApprovedPersons();
            }
        }
        
        function registerDriver() {
            const name = document.getElementById('driverName').value;
            const vehicle = document.getElementById('driverVehicle').value;
            const phone = document.getElementById('driverPhone').value;
            const type = document.getElementById('driverType').value;
            
            if (!name || !vehicle || !phone || !type) {
                admin.showToast('ëª¨ë“  í•„ë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.', 'error');
                return;
            }
            
            admin.addActivity({
                time: new Date().toLocaleTimeString(),
                content: `ìƒˆ ê¸°ì‚¬ ë“±ë¡: ${name} (${admin.getDriverTypeName(type)})`
            });
            
            admin.showToast(`ê¸°ì‚¬ ${name}ë‹˜ì´ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.`, 'success');
            document.getElementById('driverForm').reset();
        }
        
        function sendDriverMessage() {
            const message = document.getElementById('messageContent').value.trim();
            if (!message) {
                admin.showToast('ë©”ì‹œì§€ ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.', 'error');
                return;
            }
            
            admin.addActivity({
                time: new Date().toLocaleTimeString(),
                content: `ê¸°ì‚¬ì—ê²Œ ë©”ì‹œì§€ ì „ì†¡: ${message.substring(0, 30)}${message.length > 30 ? '...' : ''}`
            });
            
            admin.showToast('ë©”ì‹œì§€ë¥¼ ì „ì†¡í–ˆìŠµë‹ˆë‹¤.', 'success');
            document.getElementById('messageContent').value = '';
        }
        
        async function searchNearbyCCTVs() {
            admin.addActivity({
                time: new Date().toLocaleTimeString(),
                content: 'CCTV ê²€ìƒ‰ì„ ì‹œì‘í•©ë‹ˆë‹¤.'
            });
            
            admin.showToast('CCTV ê²€ìƒ‰ ê¸°ëŠ¥ì´ ì‹¤í–‰ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
        }
        
        function displayCCTVList(cctvs) {
            const container = document.getElementById('cctvList');
            container.innerHTML = '<div style="text-align: center; padding: 2rem; color: #9ca3af;">CCTV ê²€ìƒ‰ ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.</div>';
        }
        
        function showCCTVDetail(cctvId, cctvDataEncoded) {
            const container = document.getElementById('cctvDetail');
            container.innerHTML = '<p style="text-align: center; color: #9ca3af;">CCTV ìƒì„¸ ì •ë³´ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.</p>';
        }

        function controlCCTV(cctvId, action) {
            admin.addActivity({
                time: new Date().toLocaleTimeString(),
                content: `CCTV ${cctvId} ì œì–´ ëª…ë ¹ ì „ì†¡`
            });
            
            admin.showToast('CCTV ì œì–´ ëª…ë ¹ì„ ì „ì†¡í–ˆìŠµë‹ˆë‹¤.', 'success');
        }
        
        function requestCCTVFootage(cctvId) {
            admin.addActivity({
                time: new Date().toLocaleTimeString(),
                content: `CCTV ${cctvId} AI ì˜ìƒ ë¶„ì„ ìš”ì²­`
            });
            
            admin.showToast('AI ì˜ìƒ ë¶„ì„ì„ ìš”ì²­í–ˆìŠµë‹ˆë‹¤.', 'success');
        }

        function closePersonDetail() {
            const modal = document.getElementById('personDetailModal');
            modal.style.display = 'none';
        }

        // ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸°
        document.addEventListener('DOMContentLoaded', function() {
            // ì‹¤ì¢…ì ì‹ ê³  íƒ­ ë²„íŠ¼ì— ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
            const reportsTabButton = document.querySelector('[onclick="switchTab(\'reports\')"]');
            if (reportsTabButton) {
                reportsTabButton.addEventListener('click', function() {
                    console.log('ì‹¤ì¢…ì ì‹ ê³  íƒ­ í´ë¦­ë¨');
                    setTimeout(() => {
                        loadPendingReports();
                        loadApprovedPersons();
                    }, 100);
                });
            }
            
            // ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸°
            const modal = document.getElementById('personDetailModal');
            if (modal) {
                modal.addEventListener('click', function(e) {
                    if (e.target === modal) {
                        closePersonDetail();
                    }
                });
            }
        });

        async function showPersonDetail(personId) {
            console.log('ìƒì„¸ ì •ë³´ í‘œì‹œ:', personId);  // ë””ë²„ê¹…ìš©
            
            try {
                const response = await fetch(`${API_BASE_URL}/api/person/${personId}`);
                const person = await response.json();
                
                if (!response.ok) {
                    admin.showToast('ì‹¤ì¢…ì ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.', 'error');
                    return;
                }
                
                const modal = document.getElementById('personDetailModal');
                const content = document.getElementById('personDetailContent');
                
                // HTML ìƒì„± (ê¸°ì¡´ ì½”ë“œ ê·¸ëŒ€ë¡œ ì‚¬ìš©)
                content.innerHTML = `
                    <div style="display: flex; gap: 2rem; margin-bottom: 2rem;">
                        <div>
                            ${person.photo_url || person.photo_base64 ? 
                                `<img src="${person.photo_url || person.photo_base64}" 
                                    style="width: 150px; height: 150px; border-radius: 8px; object-fit: cover;">` :
                                `<div style="width: 150px; height: 150px; background: #f3f4f6; border-radius: 8px; 
                                            display: flex; align-items: center; justify-content: center;">
                                    <span style="font-size: 3rem;">ğŸ‘¤</span>
                                </div>`
                            }
                        </div>
                        <div style="flex: 1;">
                            <h2 style="font-size: 1.5rem; font-weight: 700; margin-bottom: 1rem;">
                                ${person.name || 'ì´ë¦„ ë¯¸ìƒ'}
                            </h2>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem;">
                                <div><strong>ë‚˜ì´:</strong> ${person.age || 'ë¯¸ìƒ'}ì„¸</div>
                                <div><strong>ì„±ë³„:</strong> ${person.gender || 'ë¯¸ìƒ'}</div>
                                <div><strong>ë¶„ë¥˜:</strong> ${person.category || 'ê¸°íƒ€'}</div>
                                <div><strong>ìš°ì„ ìˆœìœ„:</strong> <span style="color: ${person.priority === 'HIGH' ? '#ef4444' : '#f59e0b'}">${person.priority}</span></div>
                            </div>
                        </div>
                    </div>
                    
                    <div style="margin-bottom: 1rem;">
                        <h4 style="font-weight: 600; margin-bottom: 0.5rem;">ì‹¤ì¢… ì¥ì†Œ</h4>
                        <p>${person.location || 'ì •ë³´ ì—†ìŒ'}</p>
                    </div>
                    
                    ${person.description ? `
                    <div style="margin-bottom: 1rem;">
                        <h4 style="font-weight: 600; margin-bottom: 0.5rem;">ìƒì„¸ ì„¤ëª…</h4>
                        <p style="white-space: pre-line;">${person.description}</p>
                    </div>
                    ` : ''}
                    
                    ${person.extracted_features && person.extracted_features['ì¶”ê°€ì •ë³´'] ? `
                    <div style="background: #f0f9ff; padding: 1rem; border-radius: 8px; border: 2px solid #3b82f6; margin-bottom: 1rem;">
                        <h4 style="color: #1e40af; font-weight: 600; margin-bottom: 0.5rem;">ğŸ“‹ ìƒì„¸ ì¶”ê°€ ì •ë³´</h4>
                        <ul style="margin: 0; padding-left: 1.5rem;">
                            ${person.extracted_features['ì¶”ê°€ì •ë³´'].map(info => 
                                `<li style="margin-bottom: 0.5rem;">${info}</li>`
                            ).join('')}
                        </ul>
                    </div>
                    ` : ''}
                    
                    ${person.risk_factors && person.risk_factors.length > 0 ? `
                    <div style="margin-bottom: 1rem;">
                        <h4 style="font-weight: 600; margin-bottom: 0.5rem;">ìœ„í—˜ ìš”ì†Œ</h4>
                        <div style="display: flex; flex-wrap: wrap; gap: 0.5rem;">
                            ${person.risk_factors.map(factor => 
                                `<span style="background: #fee2e2; color: #991b1b; padding: 0.25rem 0.75rem; 
                                            border-radius: 16px; font-size: 0.75rem;">${factor}</span>`
                            ).join('')}
                        </div>
                    </div>
                    ` : ''}
                `;
                
                // ëª¨ë‹¬ í‘œì‹œ
                modal.style.display = 'flex';
                console.log('ëª¨ë‹¬ í‘œì‹œë¨');  // ë””ë²„ê¹…ìš©
                
            } catch (error) {
                console.error('ìƒì„¸ ì •ë³´ ë¡œë“œ ì˜¤ë¥˜:', error);
                admin.showToast('ì‹¤ì¢…ì ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤', 'error');
            }
        }

        class AdminDashboard {
            constructor() {
                this.ws = null;
                this.persons = [];
                this.drivers = [];
                this.selectedPerson = null;
                this.selectedDriver = null;
                this.isConnected = false;
                this.nerServerConnected = false;
                this.map = null;
                this.geocoder = null;
                this.markers = [];
                this.driverMarkers = [];
                this.heatmapCircles = [];
                this.showHeatmap = true;
                this.showDrivers = true;
                this.heatmapOpacity = 0.15;
                this.personVisibility = {};
                
                this.SEARCH_RADIUS_BY_CATEGORY = {
                    'ë¯¸ì·¨í•™ì•„ë™': 1600,
                    'í•™ë ¹ê¸°ì•„ë™': 1600,
                    'ì¹˜ë§¤í™˜ì': 3840,
                    'ì§€ì ì¥ì• ì¸': 2000,
                    'ìíì¥ì• ì¸': 1800,
                    'ì„±ì¸ê°€ì¶œ': 8000,
                    'ê¸°íƒ€': 3000
                };

                this.SEARCH_DESCRIPTIONS = {
                    'ë¯¸ì·¨í•™ì•„ë™': 'ì—°êµ¬ì— ë”°ë¥´ë©´ ë¯¸ì·¨í•™ ì•„ë™ì˜ ì ˆë°˜ ì´ìƒì´ 1.6km ì´ë‚´ì—ì„œ ë°œê²¬ë©ë‹ˆë‹¤. ê³¨ë“ íƒ€ì„: 3ì‹œê°„',
                    'í•™ë ¹ê¸°ì•„ë™': 'í•™ë ¹ê¸° ì•„ë™ì€ ë‹¨ì¶•ë¡œ ì´ìš© ì¤‘ ì‹¤ì¢…ë˜ëŠ” ê²½ìš°ê°€ ë§ìŠµë‹ˆë‹¤. ê³¨ë“ íƒ€ì„: 48ì‹œê°„',
                    'ì¹˜ë§¤í™˜ì': 'ë¶€ì‚° ì§€ì—­ ì—°êµ¬ ê²°ê³¼ í‰ê·  3.84km ë‚´ì—ì„œ ë°œê²¬ë©ë‹ˆë‹¤. ì—°ë ¹ëŒ€ë³„ë¡œ ì°¨ì´ê°€ ìˆìŠµë‹ˆë‹¤. ê³¨ë“ íƒ€ì„: 48-72ì‹œê°„',
                    'ì§€ì ì¥ì• ì¸': 'ì œí•œì  ì´ë™ ëŠ¥ë ¥ì„ ê³ ë ¤í•œ ë²”ìœ„ì…ë‹ˆë‹¤. ê³¨ë“ íƒ€ì„: 48-72ì‹œê°„',
                    'ìíì¥ì• ì¸': 'ì˜ì‚¬ì†Œí†µ ì–´ë ¤ì›€ìœ¼ë¡œ ìˆ˜ìƒ‰ì´ ë³µì¡í•©ë‹ˆë‹¤. ê³¨ë“ íƒ€ì„: 48-72ì‹œê°„',
                    'ì„±ì¸ê°€ì¶œ': 'ì˜ë„ì  ì´ë™ìœ¼ë¡œ ë„“ì€ ìˆ˜ìƒ‰ ë²”ìœ„ê°€ í•„ìš”í•©ë‹ˆë‹¤. ê³¨ë“ íƒ€ì„: 24ì‹œê°„',
                    'ê¸°íƒ€': 'í‰ê· ì ì¸ ìˆ˜ìƒ‰ ë²”ìœ„ë¥¼ ì ìš©í•©ë‹ˆë‹¤.'
                };

                this.KOREA_LOCATIONS = [
                    { name: 'ì„œìš¸', lat: 37.5665, lng: 126.9780 },
                    { name: 'ë¶€ì‚°', lat: 35.1796, lng: 129.0756 },
                    { name: 'ëŒ€êµ¬', lat: 35.8714, lng: 128.6014 },
                    { name: 'ì¸ì²œ', lat: 37.4563, lng: 126.7052 },
                    { name: 'ê´‘ì£¼', lat: 35.1595, lng: 126.8526 },
                    { name: 'ëŒ€ì „', lat: 36.3504, lng: 127.3845 },
                    { name: 'ìš¸ì‚°', lat: 35.5384, lng: 129.3114 },
                    { name: 'ìˆ˜ì›', lat: 37.2636, lng: 127.0286 },
                    { name: 'ì²­ì£¼', lat: 36.6424, lng: 127.4890 },
                    { name: 'ì „ì£¼', lat: 35.8242, lng: 127.1480 },
                    { name: 'ì¶˜ì²œ', lat: 37.8813, lng: 127.7298 },
                    { name: 'ì„¸ì¢…', lat: 36.4801, lng: 127.2890 },
                    { name: 'í¬í•­', lat: 36.0190, lng: 129.3435 },
                    { name: 'ì°½ì›', lat: 35.2538, lng: 128.6402 },
                    { name: 'ê³ ì–‘', lat: 37.6584, lng: 126.8320 },
                    { name: 'ìš©ì¸', lat: 37.2411, lng: 127.1775 },
                    { name: 'ì„±ë‚¨', lat: 37.4449, lng: 127.1388 },
                    { name: 'ë¶€ì²œ', lat: 37.5034, lng: 126.7660 },
                    { name: 'ì•ˆì‚°', lat: 37.3218, lng: 126.8309 },
                    { name: 'ì•ˆì–‘', lat: 37.3943, lng: 126.9568 },
                    { name: 'í‰íƒ', lat: 36.9921, lng: 127.1128 },
                    { name: 'ì˜ì •ë¶€', lat: 37.7383, lng: 127.0338 },
                    { name: 'ì‹œí¥', lat: 37.3802, lng: 126.8028 },
                    { name: 'ê¹€í¬', lat: 37.6159, lng: 126.7154 },
                    { name: 'í™”ì„±', lat: 37.1996, lng: 127.0313 },
                    { name: 'ë‚¨ì–‘ì£¼', lat: 37.6367, lng: 127.2168 },
                    { name: 'íŒŒì£¼', lat: 37.7601, lng: 126.7799 },
                    { name: 'ì˜ì™•', lat: 37.3448, lng: 126.9687 },
                    { name: 'í•˜ë‚¨', lat: 37.5393, lng: 127.2145 }
                ];
                
                this.initWebSocket();
                this.initEventListeners();
                this.loadInitialData();
                this.checkKakaoMapAPI();
                this.startDriverSimulation();
                this.checkServerStatus();
                
                setInterval(() => this.updateStats(), 30000);
                setInterval(() => this.updateDriverPositions(), 3000);
                setInterval(() => this.updateDriverStatus(), 10000);
                setInterval(() => this.checkServerStatus(), 60000);
            }

            checkKakaoMapAPI() {
                if (typeof kakao === 'undefined' || !kakao.maps) {
                    document.getElementById('apiKeySetup').innerHTML = `
                        <h3>ì¹´ì¹´ì˜¤ë§µ API ì˜¤ë¥˜</h3>
                        <p>ì¹´ì¹´ì˜¤ë§µ APIë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>
                        <p><code>.env</code> íŒŒì¼ì— <code>KAKAO_JAVASCRIPT_KEY</code>ê°€ ì˜¬ë°”ë¥´ê²Œ ì„¤ì •ë˜ì—ˆëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”.</p>
                    `;
                    this.showToast('ì¹´ì¹´ì˜¤ë§µ API í‚¤ë¥¼ í™•ì¸í•˜ì„¸ìš”', 'error');
                    return;
                }
                
                setTimeout(() => {
                    this.initializeKakaoMap();
                }, 1000);
            }

            getSearchRadius(person) {
                let category = person.category;
                
                if (!category || category === 'null' || category === 'ê¸°íƒ€') {
                    if (person.age) {
                        if (person.age <= 8) {
                            category = 'ë¯¸ì·¨í•™ì•„ë™';
                        } else if (person.age <= 18) {
                            category = 'í•™ë ¹ê¸°ì•„ë™';
                        } else if (person.age >= 65) {
                            category = 'ì¹˜ë§¤í™˜ì';
                        } else {
                            category = 'ì„±ì¸ê°€ì¶œ';
                        }
                    } else {
                        category = 'ê¸°íƒ€';
                    }
                }
                
                return this.SEARCH_RADIUS_BY_CATEGORY[category] || this.SEARCH_RADIUS_BY_CATEGORY['ê¸°íƒ€'];
            }

            getSearchDescription(person) {
                let category = person.category;
                
                if (!category || category === 'null' || category === 'ê¸°íƒ€') {
                    if (person.age) {
                        if (person.age <= 8) {
                            category = 'ë¯¸ì·¨í•™ì•„ë™';
                        } else if (person.age <= 18) {
                            category = 'í•™ë ¹ê¸°ì•„ë™';
                        } else if (person.age >= 65) {
                            category = 'ì¹˜ë§¤í™˜ì';
                        } else {
                            category = 'ì„±ì¸ê°€ì¶œ';
                        }
                    } else {
                        category = 'ê¸°íƒ€';
                    }
                }
                
                return this.SEARCH_DESCRIPTIONS[category] || this.SEARCH_DESCRIPTIONS['ê¸°íƒ€'];
            }

            async checkServerStatus() {
                try {
                    const mainResponse = await fetch(`${API_BASE_URL}/api/statistics`);
                    const mainStatus = mainResponse.ok;
                    this.updateServerIndicator('mainServerStatus', mainStatus);
                    
                    const nerResponse = await fetch(`${NER_API_URL}/api/health`);
                    const nerStatus = nerResponse.ok;
                    this.updateServerIndicator('nerServerStatus', nerStatus);
                    this.nerServerConnected = nerStatus;
                    
                    this.updateServerIndicator('firebaseServerStatus', this.isConnected);
                    
                } catch (error) {
                    console.error('ì„œë²„ ìƒíƒœ í™•ì¸ ì˜¤ë¥˜:', error);
                    this.updateServerIndicator('mainServerStatus', false);
                    this.updateServerIndicator('nerServerStatus', false);
                    this.updateServerIndicator('firebaseServerStatus', false);
                }
            }

            updateServerIndicator(elementId, isOnline) {
                const element = document.getElementById(elementId);
                if (element) {
                    element.className = `server-indicator ${isOnline ? 'online' : 'offline'}`;
                }
            }
            
            initializeKakaoMap() {
                if (typeof kakao === 'undefined' || !kakao.maps) {
                    this.showToast('ì¹´ì¹´ì˜¤ë§µ APIê°€ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.', 'error');
                    return;
                }

                try {
                    const mapContainer = document.getElementById('map');
                    const mapOption = {
                        center: new kakao.maps.LatLng(36.3504119, 127.3845475),
                        level: 8
                    };

                    this.map = new kakao.maps.Map(mapContainer, mapOption);
                    this.geocoder = new kakao.maps.services.Geocoder();

                    document.getElementById('apiKeySetup').style.display = 'none';
                    document.getElementById('map').style.display = 'block';
                    document.getElementById('mapOverlay').style.display = 'flex';
                    document.getElementById('mapStatus').className = 'status-indicator';
                    
                    setTimeout(() => {
                        this.map.relayout();
                        this.updateMapMarkers();
                    }, 500);
                    
                    this.addActivity({
                        time: new Date().toLocaleTimeString(),
                        content: 'ì¹´ì¹´ì˜¤ë§µì´ ì„±ê³µì ìœ¼ë¡œ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.'
                    });
                    
                    this.showToast('ì¹´ì¹´ì˜¤ë§µì´ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
                } catch (error) {
                    this.showToast('ì¹´ì¹´ì˜¤ë§µ ì´ˆê¸°í™” ì‹¤íŒ¨: ' + error.message, 'error');
                }
            }

            toggleAllPersons(visible) {
                this.persons.forEach(person => {
                    this.personVisibility[person.id] = visible;
                });
                this.renderPersonList();
                setTimeout(() => {
                    this.updateMapMarkers();
                }, 100);
            }

            togglePersonVisibility(personId, visible) {
                this.personVisibility[personId] = visible;
                setTimeout(() => {
                    this.updateMapMarkers();
                }, 100);
            }

            async updateMapMarkers() {
                if (!this.map) return;
                
                this.clearMarkers();
                this.clearHeatmap();
                
                const visiblePersons = this.persons.filter(p => this.personVisibility[p.id] !== false);
                
                let markersCreated = 0;
                
                for (const person of visiblePersons) {
                    if (person.lat && person.lng && person.lat !== 36.5 && person.lng !== 127.8) {
                        this.createMarker(person, person.lat, person.lng);
                        this.addHeatmapForPerson(person, person.lat, person.lng);
                        markersCreated++;
                    } else if (person.location && this.geocoder) {
                        try {
                            await this.addMarkerWithGeocoding(person);
                            markersCreated++;
                        } catch (error) {
                            console.log(`ì§€ì˜¤ì½”ë”© ì‹¤íŒ¨ (${person.name}): ${error}`);
                        }
                    }
                }
                
                if (this.showDrivers) {
                    this.updateDriverMarkers();
                }
                
                document.getElementById('markerCount').textContent = `ë§ˆì»¤: ${markersCreated}ê°œ`;
                document.getElementById('driverCount').textContent = `ì˜¨ë¼ì¸ ê¸°ì‚¬: ${this.drivers.filter(d => d.status === 'online').length}ëª…`;
            }

            clearHeatmap() {
                this.heatmapCircles.forEach(circle => circle.setMap(null));
                this.heatmapCircles = [];
            }

            addHeatmapForPerson(person, lat, lng) {
                if (!this.showHeatmap) return;
                
                const radius = this.getSearchRadius(person);
                const position = new kakao.maps.LatLng(lat, lng);
                
                const innerCircle = new kakao.maps.Circle({
                    center: position,
                    radius: radius * 0.6,
                    strokeWeight: 2,
                    strokeColor: '#FF4444',
                    strokeOpacity: this.heatmapOpacity * 0.8,
                    fillColor: '#FF4444',
                    fillOpacity: this.heatmapOpacity * 0.5
                });
                
                const outerCircle = new kakao.maps.Circle({
                    center: position,
                    radius: radius,
                    strokeWeight: 2,
                    strokeColor: '#FF8800',
                    strokeOpacity: this.heatmapOpacity * 0.6,
                    fillColor: '#FF8800',
                    fillOpacity: this.heatmapOpacity * 0.3
                });
                
                innerCircle.setMap(this.map);
                outerCircle.setMap(this.map);
                
                this.heatmapCircles.push(innerCircle, outerCircle);
            }

            updateHeatmapOpacity() {
                const rawValue = parseFloat(document.getElementById('heatmapOpacity').value);
                this.heatmapOpacity = rawValue;
                const displayValue = Math.round(rawValue * 100);
                document.getElementById('opacityValue').textContent = displayValue + '%';
                
                if (this.showHeatmap) {
                    this.clearHeatmap();
                    
                    this.persons.forEach((person) => {
                        if (this.personVisibility[person.id] !== false && person.lat && person.lng) {
                            this.addHeatmapForPerson(person, person.lat, person.lng);
                        }
                    });
                }
            }

            toggleHeatmap() {
                this.showHeatmap = document.getElementById('showHeatmap').checked;
                this.updateMapMarkers();
            }

            toggleDriverVisibility() {
                this.showDrivers = document.getElementById('showDrivers').checked;
                if (this.showDrivers) {
                    this.updateDriverMarkers();
                } else {
                    this.driverMarkers.forEach(marker => marker.setMap(null));
                    this.driverMarkers = [];
                }
                document.getElementById('driverCount').textContent = `ì˜¨ë¼ì¸ ê¸°ì‚¬: ${this.drivers.filter(d => d.status === 'online').length}ëª…`;
            }

            async addMarkerWithGeocoding(person) {
                return new Promise((resolve, reject) => {
                    this.geocoder.addressSearch(person.location, (result, status) => {
                        if (status === kakao.maps.services.Status.OK) {
                            const lat = parseFloat(result[0].y);
                            const lng = parseFloat(result[0].x);
                            
                            person.lat = lat;
                            person.lng = lng;
                            
                            this.createMarker(person, lat, lng);
                            this.addHeatmapForPerson(person, lat, lng);
                            resolve();
                        } else {
                            reject(new Error(`ì§€ì˜¤ì½”ë”© ì‹¤íŒ¨: ${status}`));
                        }
                    });
                });
            }
            
            clearMarkers() {
                this.markers.forEach(marker => marker.setMap(null));
                this.markers = [];
            }
            
            createMarker(person, lat, lng) {
                const position = new kakao.maps.LatLng(lat, lng);
                
                const marker = new kakao.maps.Marker({
                    position: position,
                    map: this.map
                });

                const radius = this.getSearchRadius(person);
                const description = this.getSearchDescription(person);
                
                let displayCategory = person.category;
                if (!displayCategory || displayCategory === 'null' || displayCategory === 'ê¸°íƒ€') {
                    if (person.age) {
                        if (person.age <= 8) displayCategory = 'ë¯¸ì·¨í•™ì•„ë™';
                        else if (person.age <= 18) displayCategory = 'í•™ë ¹ê¸°ì•„ë™';
                        else if (person.age >= 65) displayCategory = 'ê³ ë ¹ì';
                        else displayCategory = 'ì„±ì¸';
                    } else {
                        displayCategory = 'ê¸°íƒ€';
                    }
                }

                const infoContent = `
                    <div style="padding:15px; min-width:300px;">
                        <h4 style="margin:0 0 10px 0; color:#2c3e50;">${person.name || 'ì´ë¦„ ë¯¸ìƒ'}</h4>
                        <div style="font-size:14px; color:#555; line-height:1.6;">
                            <div><strong>ë‚˜ì´:</strong> ${person.age || 'ë¯¸ìƒ'}ì„¸ | <strong>ë¶„ë¥˜:</strong> ${displayCategory}</div>
                            <div><strong>ìš°ì„ ìˆœìœ„:</strong> ${person.priority || 'MEDIUM'}</div>
                            <div><strong>ì‹¤ì¢…ì¥ì†Œ:</strong> ${person.location || 'ë¯¸ìƒ'}</div>
                            <div style="background:#f0f9ff; padding:8px; border-radius:4px; margin:8px 0;">
                                <strong>ìˆ˜ìƒ‰ë²”ìœ„:</strong> ${(radius/1000).toFixed(1)}km<br>
                                <small style="color:#1e40af;">${description}</small>
                            </div>
                        </div>
                    </div>
                `;

                const infoWindow = new kakao.maps.InfoWindow({
                    content: infoContent,
                    removable: true
                });

                kakao.maps.event.addListener(marker, 'click', () => {
                    infoWindow.open(this.map, marker);
                    this.selectPerson(person.id);
                });

                this.markers.push(marker);
            }
            
            updateDriverMarkers() {
                if (!this.map || !this.showDrivers) return;
                
                this.driverMarkers.forEach(marker => marker.setMap(null));
                this.driverMarkers = [];
                
                const onlineDrivers = this.drivers.filter(driver => driver.status === 'online');
                const displayDrivers = onlineDrivers.slice(0, 500);
                
                displayDrivers.forEach(driver => {
                    this.createDriverMarker(driver);
                });
            }

            createDriverMarker(driver) {
                const position = new kakao.maps.LatLng(driver.lat, driver.lng);
                
                const markerImageSrc = `data:image/svg+xml;charset=utf-8,${encodeURIComponent(`
                    <svg width="16" height="16" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg">
                        <circle cx="8" cy="8" r="6" fill="${driver.type === 'taxi' ? '#2563eb' : '#059669'}" stroke="white" stroke-width="1"/>
                        <text x="8" y="11" text-anchor="middle" fill="white" font-size="8">${driver.type === 'taxi' ? 'T' : 'D'}</text>
                    </svg>
                `)}`;
                
                const markerImageSize = new kakao.maps.Size(16, 16);
                const markerImage = new kakao.maps.MarkerImage(markerImageSrc, markerImageSize);
                
                const marker = new kakao.maps.Marker({
                    position: position,
                    map: this.map,
                    image: markerImage
                });

                const infoContent = `
                    <div style="padding:15px; min-width:200px;">
                        <h4 style="margin:0 0 10px 0; color:#2c3e50;">${driver.name} ê¸°ì‚¬</h4>
                        <div style="font-size:14px; color:#555; line-height:1.6;">
                            <div><strong>ì°¨ëŸ‰ë²ˆí˜¸:</strong> ${driver.vehicle}</div>
                            <div><strong>ì—…ì¢…:</strong> ${this.getDriverTypeName(driver.type)}</div>
                            <div><strong>ì§€ì—­:</strong> ${driver.region}</div>
                            <div><strong>í˜„ì¬ì†ë„:</strong> ${driver.speed === 0 && driver.type === 'delivery' ? 'ë°°ë‹¬ì¤‘ (ì •ì§€)' : Math.round(driver.speed) + 'km/h'}</div>
                            <div><strong>ìƒíƒœ:</strong> <span style="color: #10b981;">${driver.status === 'online' ? 'ìš´í–‰ì¤‘' : 'ì˜¤í”„ë¼ì¸'}</span></div>
                            <div><strong>ì´ë™íŒ¨í„´:</strong> ${driver.type === 'taxi' ? 'ë„ë¡œ ì£¼í–‰' : 'ììœ  ì´ë™'}</div>
                        </div>
                    </div>
                `;

                const infoWindow = new kakao.maps.InfoWindow({
                    content: infoContent,
                    removable: true
                });

                kakao.maps.event.addListener(marker, 'click', () => {
                    infoWindow.open(this.map, marker);
                    this.selectDriver(driver.id);
                });

                this.driverMarkers.push(marker);
            }

            startDriverSimulation() {
                const driverTypes = ['taxi', 'delivery'];
                const regions = [
                    { name: 'ì„œìš¸', count: 330, baseNames: ['ê¹€ì„œìš¸', 'ì´ê°•ë‚¨', 'ë°•ì¢…ë¡œ', 'ìµœë§ˆí¬', 'ì •ì†¡íŒŒ', 'ì¡°ì„œì´ˆ', 'ìœ¤ê°•ë™', 'ì†¡ë…¸ì›', 'í•œì„±ë¶', 'í™ì€í‰'] },
                    { name: 'ë¶€ì‚°', count: 200, baseNames: ['ê¹€ë¶€ì‚°', 'ì´í•´ìš´', 'ë°•ìˆ˜ì˜', 'ìµœì‚¬í•˜', 'ì •ê¸°ì¥', 'ì¡°ë‚¨êµ¬', 'ìœ¤ë™ë˜', 'ì†¡ì„œêµ¬', 'í•œì˜ë„', 'í™ì¤‘êµ¬'] },
                    { name: 'ëŒ€êµ¬', count: 150, baseNames: ['ê¹€ëŒ€êµ¬', 'ì´ìˆ˜ì„±', 'ë°•ë‹¬ì„œ', 'ìµœë¶êµ¬', 'ì •ì¤‘êµ¬', 'ì¡°ë™êµ¬', 'ìœ¤ë‹¬ì„±', 'ì†¡ì„œêµ¬', 'í•œë‚¨êµ¬', 'í™ìˆ˜ì„±'] },
                    { name: 'ì¸ì²œ', count: 180, baseNames: ['ê¹€ì¸ì²œ', 'ì´ë‚¨ë™', 'ë°•ì—°ìˆ˜', 'ìµœë¶€í‰', 'ì •ì„œêµ¬', 'ì¡°ì¤‘êµ¬', 'ìœ¤ë™êµ¬', 'ì†¡ê³„ì–‘', 'í•œê°•í™”', 'í™ì˜¹ì§„'] },
                    { name: 'ê´‘ì£¼', count: 120, baseNames: ['ê¹€ê´‘ì£¼', 'ì´ì„œêµ¬', 'ë°•ë‚¨êµ¬', 'ìµœë¶êµ¬', 'ì •ë™êµ¬', 'ì¡°ê´‘ì‚°', 'ìœ¤ì„œêµ¬', 'ì†¡ë‚¨êµ¬', 'í•œë¶êµ¬', 'í™ë™êµ¬'] },
                    { name: 'ëŒ€ì „', count: 170, baseNames: ['ê¹€ëŒ€ì „', 'ì´ì„œêµ¬', 'ë°•ìœ ì„±', 'ìµœì¤‘êµ¬', 'ì •ë™êµ¬', 'ì¡°ëŒ€ë•', 'ìœ¤ì„œêµ¬', 'ì†¡ì¤‘êµ¬', 'í•œìœ ì„±', 'í™ë™êµ¬'] },
                    { name: 'ìš¸ì‚°', count: 100, baseNames: ['ê¹€ìš¸ì‚°', 'ì´ë‚¨êµ¬', 'ë°•ë™êµ¬', 'ìµœë¶êµ¬', 'ì •ì¤‘êµ¬', 'ì¡°ìš¸ì£¼', 'ìœ¤ë‚¨êµ¬', 'ì†¡ë™êµ¬', 'í•œë¶êµ¬', 'í™ì¤‘êµ¬'] },
                    { name: 'ê²½ê¸°', count: 400, baseNames: ['ê¹€ìˆ˜ì›', 'ì´ì„±ë‚¨', 'ë°•ê³ ì–‘', 'ìµœìš©ì¸', 'ì •ë¶€ì²œ', 'ì¡°ì•ˆì‚°', 'ìœ¤ì•ˆì–‘', 'ì†¡ë‚¨ì–‘ì£¼', 'í•œí™”ì„±', 'í™íŒŒì£¼'] },
                    { name: 'ê°•ì›', count: 80, baseNames: ['ê¹€ì¶˜ì²œ', 'ì´ì›ì£¼', 'ë°•ê°•ë¦‰', 'ìµœë™í•´', 'ì •ì†ì´ˆ', 'ì¡°ì‚¼ì²™', 'ìœ¤í™ì²œ', 'ì†¡íš¡ì„±', 'í•œí‰ì°½', 'í™ì •ì„ '] },
                    { name: 'ì¶©ë¶', count: 70, baseNames: ['ê¹€ì²­ì£¼', 'ì´ì¶©ì£¼', 'ë°•ì œì²œ', 'ìµœìŒì„±', 'ì •ì§„ì²œ', 'ì¡°ë‹¨ì–‘', 'ìœ¤ì˜ë™', 'ì†¡ê´´ì‚°', 'í•œë³´ì€', 'í™ì˜¥ì²œ'] },
                    { name: 'ì¶©ë‚¨', count: 90, baseNames: ['ê¹€ì²œì•ˆ', 'ì´ì•„ì‚°', 'ë°•ì„œì‚°', 'ìµœë³´ë ¹', 'ì •ë‹¹ì§„', 'ì¡°ë…¼ì‚°', 'ìœ¤ê³„ë£¡', 'ì†¡ê³µì£¼', 'í•œí™ì„±', 'í™ì˜ˆì‚°'] },
                    { name: 'ì „ë¶', count: 75, baseNames: ['ê¹€ì „ì£¼', 'ì´êµ°ì‚°', 'ë°•ìµì‚°', 'ìµœì •ì', 'ì •ë‚¨ì›', 'ì¡°ê¹€ì œ', 'ìœ¤ì™„ì£¼', 'ì†¡ì§„ì•ˆ', 'í•œë¬´ì£¼', 'í™ì¥ìˆ˜'] },
                    { name: 'ì „ë‚¨', count: 85, baseNames: ['ê¹€ëª©í¬', 'ì´ì—¬ìˆ˜', 'ë°•ìˆœì²œ', 'ìµœë‚˜ì£¼', 'ì •ê´‘ì–‘', 'ì¡°ë‹´ì–‘', 'ìœ¤ê³¡ì„±', 'ì†¡êµ¬ë¡€', 'í•œê³ í¥', 'í™ë³´ì„±'] },
                    { name: 'ê²½ë¶', count: 110, baseNames: ['ê¹€í¬í•­', 'ì´ê²½ì£¼', 'ë°•ì•ˆë™', 'ìµœêµ¬ë¯¸', 'ì •ì˜ì£¼', 'ì¡°ìƒì£¼', 'ìœ¤ë¬¸ê²½', 'ì†¡ê¹€ì²œ', 'í•œì¹ ê³¡', 'í™ì„±ì£¼'] },
                    { name: 'ê²½ë‚¨', count: 130, baseNames: ['ê¹€ì°½ì›', 'ì´ì§„ì£¼', 'ë°•í†µì˜', 'ìµœì‚¬ì²œ', 'ì •ê¹€í•´', 'ì¡°ë°€ì–‘', 'ìœ¤ê±°ì œ', 'ì†¡ì–‘ì‚°', 'í•œì˜ë ¹', 'í™í•¨ì•ˆ'] }
                ];
                
                let driverIndex = 0;
                
                regions.forEach(region => {
                    const locations = this.KOREA_LOCATIONS.filter(loc => 
                        loc.name.includes(region.name) || region.name.includes(loc.name)
                    );
                    const baseLocation = locations[0] || this.KOREA_LOCATIONS[0];
                    
                    for (let i = 0; i < region.count; i++) {
                        const type = driverTypes[Math.floor(Math.random() * driverTypes.length)];
                        const baseName = region.baseNames[Math.floor(Math.random() * region.baseNames.length)];
                        const suffix = type === 'taxi' ? 'íƒì‹œ' : 'ë¼ì´ë”';
                        const name = baseName + suffix + (i % 50 + 1);
                        
                        setTimeout(() => {
                            const newDriver = {
                                id: 'driver_' + driverIndex++,
                                name: name,
                                vehicle: this.generateVehicleNumber(region.name),
                                phone: '010-' + String(Math.floor(Math.random() * 10000)).padStart(4, '0') + '-' + String(Math.floor(Math.random() * 10000)).padStart(4, '0'),
                                type: type,
                                region: region.name,
                                lat: baseLocation.lat + (Math.random() - 0.5) * 0.3,
                                lng: baseLocation.lng + (Math.random() - 0.5) * 0.3,
                                status: Math.random() > 0.25 ? 'online' : 'offline',
                                speed: Math.random() * 40 + 20,
                                heading: Math.random() * 360
                            };
                            
                            this.drivers.push(newDriver);
                            
                            if (driverIndex % 100 === 0) {
                                this.updateDriverList();
                                this.updateDriverMarkers();
                            }
                        }, i * 10);
                    }
                });
            }

            generateVehicleNumber(region) {
                const areas = {
                    'ì„œìš¸': ['ì„œìš¸'],
                    'ë¶€ì‚°': ['ë¶€ì‚°'],
                    'ëŒ€êµ¬': ['ëŒ€êµ¬'],
                    'ì¸ì²œ': ['ì¸ì²œ'],
                    'ê´‘ì£¼': ['ê´‘ì£¼'],
                    'ëŒ€ì „': ['ëŒ€ì „'],
                    'ìš¸ì‚°': ['ìš¸ì‚°'],
                    'ê²½ê¸°': ['ê²½ê¸°'],
                    'ê°•ì›': ['ê°•ì›'],
                    'ì¶©ë¶': ['ì¶©ë¶'],
                    'ì¶©ë‚¨': ['ì¶©ë‚¨'],
                    'ì „ë¶': ['ì „ë¶'],
                    'ì „ë‚¨': ['ì „ë‚¨'],
                    'ê²½ë¶': ['ê²½ë¶'],
                    'ê²½ë‚¨': ['ê²½ë‚¨'],
                    'ì œì£¼': ['ì œì£¼']
                };
                
                const area = areas[region] ? areas[region][0] : 'ê²½ê¸°';
                const numbers = String(Math.floor(Math.random() * 90) + 10);
                const chars = ['ê°€', 'ë‚˜', 'ë‹¤', 'ë¼', 'ë§ˆ', 'ë°”', 'ì‚¬', 'ì•„', 'ì', 'ì°¨'];
                const char = chars[Math.floor(Math.random() * chars.length)];
                const lastNumbers = String(Math.floor(Math.random() * 9000) + 1000);
                return `${area} ${numbers}${char}${lastNumbers}`;
            }

            updateDriverPositions() {
                this.drivers.forEach(driver => {
                    if (driver.status === 'online') {
                        const moveDistance = (driver.speed / 3600) * 3;
                        const earthRadius = 6371;
                        
                        if (driver.type === 'taxi') {
                            // íƒì‹œ: ë„ë¡œë¥¼ ë”°ë¼ ì›€ì§ì´ëŠ” ê²ƒì²˜ëŸ¼ ë” ì œí•œì ì¸ ì›€ì§ì„
                            // ë°©í–¥ ë³€ê²½ì´ ì ê³ , ê²©ì íŒ¨í„´ìœ¼ë¡œ ì›€ì§ì„ (ë„ë¡œë§ ì‹œë®¬ë ˆì´ì…˜)
                            const deltaLat = (moveDistance / earthRadius) * (180 / Math.PI) * Math.cos(driver.heading * Math.PI / 180) * 0.3;
                            const deltaLng = (moveDistance / earthRadius) * (180 / Math.PI) * Math.sin(driver.heading * Math.PI / 180) / Math.cos(driver.lat * Math.PI / 180) * 0.3;
                            
                            driver.lat += deltaLat;
                            driver.lng += deltaLng;
                            
                            // íƒì‹œëŠ” ì£¼ë¡œ ì§ê°ìœ¼ë¡œ ë°©í–¥ ì „í™˜ (ë„ë¡œ êµì°¨ì )
                            if (Math.random() < 0.02) {
                                const possibleDirections = [0, 90, 180, 270];
                                const currentDirection = Math.round(driver.heading / 90) * 90;
                                const newDirections = possibleDirections.filter(dir => Math.abs(dir - currentDirection) === 90 || Math.abs(dir - currentDirection) === 270);
                                if (newDirections.length > 0) {
                                    driver.heading = newDirections[Math.floor(Math.random() * newDirections.length)];
                                }
                            }
                            
                            // ì†ë„ ë³€í™”ë„ ì œí•œì  (ì‹ í˜¸ë“±, êµí†µ ìƒí™©)
                            driver.speed += (Math.random() - 0.5) * 5;
                            driver.speed = Math.max(15, Math.min(60, driver.speed));
                            
                        } else {
                            // ë°°ë‹¬ê¸°ì‚¬: ê°•, ë°”ë‹¤ë¥¼ ì œì™¸í•œ ì–´ëŠ ê³³ì´ë“  ììœ ë¡­ê²Œ ì›€ì§ì„
                            // ë” ììœ ë¡œìš´ ì›€ì§ì„ íŒ¨í„´
                            const deltaLat = (moveDistance / earthRadius) * (180 / Math.PI) * Math.cos(driver.heading * Math.PI / 180) * 0.8;
                            const deltaLng = (moveDistance / earthRadius) * (180 / Math.PI) * Math.sin(driver.heading * Math.PI / 180) / Math.cos(driver.lat * Math.PI / 180) * 0.8;
                            
                            driver.lat += deltaLat;
                            driver.lng += deltaLng;
                            
                            // ë°°ë‹¬ê¸°ì‚¬ëŠ” ììœ ë¡œìš´ ë°©í–¥ ì „í™˜ (ê±´ë¬¼ ì‚¬ì´, ê³¨ëª©ê¸¸, ê³µì› ë“±)
                            if (Math.random() < 0.08) {
                                driver.heading += (Math.random() - 0.5) * 180;
                                driver.heading = driver.heading % 360;
                                if (driver.heading < 0) driver.heading += 360;
                            }
                            
                            // ì†ë„ ë³€í™”ë„ ë” í¼ (ì–¸ë•, ê³„ë‹¨, ì—˜ë¦¬ë² ì´í„° ë“±)
                            driver.speed += (Math.random() - 0.5) * 15;
                            driver.speed = Math.max(5, Math.min(50, driver.speed));
                            
                            // ê°„í˜¹ ì™„ì „íˆ ë©ˆì¶¤ (ê±´ë¬¼ ë‚´ ë°°ë‹¬)
                            if (Math.random() < 0.01) {
                                driver.speed = 0;
                            } else if (driver.speed === 0 && Math.random() < 0.3) {
                                driver.speed = Math.random() * 20 + 10;
                            }
                        }
                        
                        // í•œêµ­ ì˜ì—­ì„ ë²—ì–´ë‚˜ì§€ ì•Šë„ë¡ ì œí•œ
                        driver.lat = Math.max(33.0, Math.min(38.9, driver.lat));
                        driver.lng = Math.max(125.0, Math.min(132.0, driver.lng));
                    }
                });
                
                if (this.showDrivers) {
                    this.updateDriverMarkers();
                }
            }

            updateDriverStatus() {
                this.drivers.forEach(driver => {
                    if (Math.random() < 0.03) {
                        driver.status = driver.status === 'online' ? 'offline' : 'online';
                    }
                });
                
                this.updateDriverList();
                this.updateStats();
            }

            updateDriverList() {
                const container = document.getElementById('driverList');
                
                if (!this.drivers.length) {
                    container.innerHTML = '<div style="text-align: center; padding: 2rem; color: #9ca3af;">ë“±ë¡ëœ ê¸°ì‚¬ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
                    return;
                }
                
                const onlineDrivers = this.drivers.filter(d => d.status === 'online');
                const displayDrivers = onlineDrivers.slice(0, 50);
                
                const html = displayDrivers.map(driver => {
                    const selectedClass = this.selectedDriver === driver.id ? 'selected' : '';
                    const statusClass = driver.status === 'online' ? 'online' : 'offline';
                    
                    return `
                        <div class="person-item ${selectedClass}" 
                             onclick="admin.selectDriver('${driver.id}')" data-driver-id="${driver.id}">
                            <div class="person-marker" style="background: ${driver.status === 'online' ? '#2563eb' : '#6b7280'}; color: white;">
                                ${driver.type === 'taxi' ? 'T' : 'D'}
                            </div>
                            <div class="person-info">
                                <div class="person-name">
                                    ${driver.name} (${driver.vehicle})
                                    <span class="driver-status ${statusClass}"></span>
                                </div>
                                <div class="person-details">
                                    ${this.getDriverTypeName(driver.type)} | ${driver.speed === 0 && driver.type === 'delivery' ? 'ë°°ë‹¬ì¤‘' : Math.round(driver.speed) + 'km/h'}<br>
                                    ${driver.region} | ìƒíƒœ: ${driver.status === 'online' ? 'ìš´í–‰ì¤‘' : 'ì˜¤í”„ë¼ì¸'} | ${driver.type === 'taxi' ? 'ë„ë¡œì£¼í–‰' : 'ììœ ì´ë™'}
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');
                
                container.innerHTML = html + (onlineDrivers.length > 50 ? 
                    `<div style="text-align: center; padding: 1rem; color: #9ca3af; font-size: 0.8rem;">
                        ì˜¨ë¼ì¸ ê¸°ì‚¬ ${onlineDrivers.length}ëª… ì¤‘ 50ëª… í‘œì‹œ
                    </div>` : '');
            }

            selectDriver(driverId) {
                this.selectedDriver = driverId;
                this.updateDriverList();
                
                const driver = this.drivers.find(d => d.id === driverId);
                if (driver) {
                    this.showToast(`ì„ íƒë¨: ${driver.name} ê¸°ì‚¬`, 'success');
                    
                    if (this.map) {
                        const coords = new kakao.maps.LatLng(driver.lat, driver.lng);
                        this.map.setCenter(coords);
                        this.map.setLevel(3);
                    }
                }
            }

            calculateDistance(lat1, lng1, lat2, lng2) {
                const R = 6371;
                const dLat = (lat2 - lat1) * Math.PI / 180;
                const dLng = (lng2 - lng1) * Math.PI / 180;
                const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
                        Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
                        Math.sin(dLng/2) * Math.sin(dLng/2);
                const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
                return R * c * 1000;
            }

            async getDriversInRange(personId) {
                const person = this.persons.find(p => p.id === personId);
                if (!person) return Promise.resolve([]);

                const searchRadius = this.getSearchRadius(person);
                let personLat, personLng;
                
                if (person.lat && person.lng) {
                    personLat = person.lat;
                    personLng = person.lng;
                    
                    const driversInRange = this.drivers.filter(driver => {
                        if (driver.status !== 'online') return false;
                        
                        const distance = this.calculateDistance(
                            personLat, personLng,
                            driver.lat, driver.lng
                        );
                        
                        return distance <= searchRadius;
                    });
                    
                    return Promise.resolve(driversInRange);
                }
                
                return new Promise((resolve) => {
                    if (!this.geocoder || !person.location) {
                        resolve([]);
                        return;
                    }

                    this.geocoder.addressSearch(person.location, (result, status) => {
                        if (status === kakao.maps.services.Status.OK) {
                            personLat = parseFloat(result[0].y);
                            personLng = parseFloat(result[0].x);
                            
                            const driversInRange = this.drivers.filter(driver => {
                                if (driver.status !== 'online') return false;
                                
                                const distance = this.calculateDistance(
                                    personLat, personLng,
                                    driver.lat, driver.lng
                                );
                                
                                return distance <= searchRadius;
                            });
                            
                            resolve(driversInRange);
                        } else {
                            resolve([]);
                        }
                    });
                });
            }
            
            initWebSocket() {
                const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
                const wsUrl = `${protocol}//localhost:8001/ws`;
                
                try {
                    this.ws = new WebSocket(wsUrl);
                    
                    this.ws.onopen = () => {
                        console.log('WebSocket ì—°ê²°ë¨ (í¬íŠ¸ 8001)');
                        this.isConnected = true;
                        this.updateConnectionStatus();
                    };
                    
                    this.ws.onmessage = (event) => {
                        const message = JSON.parse(event.data);
                        this.handleWebSocketMessage(message);
                    };
                    
                    this.ws.onclose = () => {
                        console.log('WebSocket ì—°ê²° ëŠì–´ì§');
                        this.isConnected = false;
                        this.updateConnectionStatus();
                        
                        setTimeout(() => this.initWebSocket(), 5000);
                    };
                    
                    this.ws.onerror = (error) => {
                        console.error('WebSocket ì˜¤ë¥˜:', error);
                    };
                } catch (error) {
                    console.error('WebSocket ì´ˆê¸°í™” ì‹¤íŒ¨:', error);
                    this.isConnected = false;
                    this.updateConnectionStatus();
                }
            }
            
            updateConnectionStatus() {
                const indicator = document.getElementById('connectionStatus');
                if (this.isConnected) {
                    indicator.classList.remove('disconnected');
                } else {
                    indicator.classList.add('disconnected');
                }
            }
            
            handleWebSocketMessage(message) {
                console.log('ë°›ì€ ë©”ì‹œì§€:', message);
                
                switch (message.type) {
                    case 'new_missing_person':
                        this.handleNewMissingPerson(message.data, message.fcm_result);
                        break;
                    case 'manual_notification_sent':
                        this.handleManualNotification(message.data);
                        break;
                            case 'new_report_pending':
                        this.showToast('ìƒˆë¡œìš´ ì‹¤ì¢…ì ì‹ ê³ ê°€ ì ‘ìˆ˜ë˜ì—ˆìŠµë‹ˆë‹¤', 'info');
                        if (document.getElementById('reports-tab').classList.contains('active')) {
                            loadPendingReports();
                        }
                        break;
                    
                    case 'person_approved':
                        this.showToast('ì‹¤ì¢…ì ì‹ ê³ ê°€ ìŠ¹ì¸ë˜ì—ˆìŠµë‹ˆë‹¤', 'success');
                        if (document.getElementById('reports-tab').classList.contains('active')) {
                            loadApprovedPersons();
                        }
                        this.loadInitialData();
                        break;
                    
                    case 'person_deleted':
                        this.showToast('ì‹¤ì¢…ìê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤', 'info');
                        this.loadInitialData();
                        break;
                }
            }
            
            handleNewMissingPerson(person, fcmResult) {
                this.persons.unshift(person);
                this.personVisibility[person.id] = true;
                
                if (!person.lat || !person.lng || (person.lat === 36.5 && person.lng === 127.8)) {
                    if (person.location) {
                        person.lat = 36.5;
                        person.lng = 127.8;
                    }
                }
                
                this.renderPersonList();
                this.updatePersonSelect();
                setTimeout(() => {
                    this.updateMapMarkers();
                }, 500);
                
                this.addActivity({
                    time: new Date().toLocaleTimeString(),
                    content: `ìƒˆë¡œìš´ ì‹¤ì¢…ì: ${person.name || 'ì´ë¦„ ë¯¸ìƒ'} (${person.location || 'ìœ„ì¹˜ ë¯¸ìƒ'})`
                });
                
                this.showToast(`ìƒˆë¡œìš´ ì‹¤ì¢…ìê°€ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤: ${person.name || 'ì´ë¦„ ë¯¸ìƒ'}`, 'success');
                this.updateStats();
            }
            
            handleManualNotification(data) {
                this.addActivity({
                    time: new Date().toLocaleTimeString(),
                    content: `ìˆ˜ë™ ì•Œë¦¼ ì „ì†¡: ${data.person.name || 'ì´ë¦„ ë¯¸ìƒ'} - ${data.result.success}/${data.result.total}`
                });
            }
            
            async loadInitialData() {
                try {
                    const response = await fetch(`${API_BASE_URL}/api/missing_persons`);
                    const data = await response.json();
                    this.persons = data.persons || [];
                    
                    this.persons.forEach(person => {
                        this.personVisibility[person.id] = true;
                        
                        if (!person.lat || !person.lng || (person.lat === 36.5 && person.lng === 127.8)) {
                            if (person.location) {
                                person.lat = 36.5;
                                person.lng = 127.8;
                            }
                        }
                    });
                    
                    this.renderPersonList();
                    this.updatePersonSelect();
                    this.updateStats();
                    
                    setTimeout(() => {
                        this.updateMapMarkers();
                    }, 1000);
                    
                } catch (error) {
                    console.error('ì´ˆê¸° ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', error);
                    this.showToast('ë°ì´í„° ë¡œë“œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤', 'error');
                }
            }
            
            renderPersonList() {
                const container = document.getElementById('personList');
                
                if (!this.persons.length) {
                    container.innerHTML = '<div style="text-align: center; padding: 2rem; color: #9ca3af;">ë“±ë¡ëœ ì‹¤ì¢…ìê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
                    return;
                }
                
                const html = this.persons.map((person, index) => {
                    const isNew = index === 0 && this.persons.length > 1;
                    const priorityClass = person.priority === 'HIGH' ? 'high-priority' : '';
                    const newClass = isNew ? 'new' : '';
                    const selectedClass = this.selectedPerson === person.id ? 'selected' : '';
                    
                    if (!(person.id in this.personVisibility)) {
                        this.personVisibility[person.id] = true;
                    }
                    
                    const riskTags = (person.risk_factors || []).map(factor => 
                        `<span class="risk-tag">${factor}</span>`
                    ).join('');

                    const radius = this.getSearchRadius(person);
                    
                    let displayCategory = person.category;
                    if (!displayCategory || displayCategory === 'null' || displayCategory === 'ê¸°íƒ€') {
                        if (person.age) {
                            if (person.age <= 8) displayCategory = 'ë¯¸ì·¨í•™ì•„ë™';
                            else if (person.age <= 18) displayCategory = 'í•™ë ¹ê¸°ì•„ë™';
                            else if (person.age >= 65) displayCategory = 'ê³ ë ¹ì';
                            else displayCategory = 'ì„±ì¸';
                        } else {
                            displayCategory = 'ê¸°íƒ€';
                        }
                    }
                    
                    return `
                        <div class="person-item ${priorityClass} ${newClass} ${selectedClass}" 
                            onclick="admin.selectPerson('${person.id}')" 
                            data-person-id="${person.id}">
                            <div style="display: flex; align-items: center; gap: 0.5rem; margin-right: 0.5rem;">
                                <input type="checkbox" 
                                    ${this.personVisibility[person.id] ? 'checked' : ''} 
                                    onchange="admin.togglePersonVisibility('${person.id}', this.checked)"
                                    onclick="event.stopPropagation()"
                                    style="margin: 0;">
                                <div class="person-marker ${(person.priority || 'medium').toLowerCase()}">
                                    !
                                </div>
                            </div>
                            <div class="person-info" ondblclick="event.stopPropagation(); showPersonDetail('${person.id}');">
                                <div class="person-name">
                                    ${person.name || 'ì´ë¦„ ë¯¸ìƒ'} (${person.age || 'ë‚˜ì´ ë¯¸ìƒ'}ì„¸)
                                </div>
                                <div class="person-details">
                                    ${person.location || 'ìœ„ì¹˜ ë¯¸ìƒ'}<br>
                                    ${displayCategory} | ìˆ˜ìƒ‰ë²”ìœ„: ${(radius/1000).toFixed(1)}km
                                </div>
                                ${riskTags ? `<div class="risk-tags">${riskTags}</div>` : ''}
                            </div>
                        </div>
                    `;
                }).join('');
                
                container.innerHTML = html;
                
                if (this.persons.length > 0) {
                    setTimeout(() => {
                        const firstItem = container.querySelector('.new');
                        if (firstItem) {
                            firstItem.classList.remove('new');
                        }
                    }, 3000);
                }
            }

            async selectPerson(personId) {
                this.selectedPerson = personId;
                
                // í˜„ì¬ ê²€ìƒ‰ì–´ ì €ì¥
                const searchInput = document.getElementById('missingPersonSearch');
                const currentSearch = searchInput ? searchInput.value : '';
                
                this.renderPersonList();
                this.updatePersonSelect();
                
                // ê²€ìƒ‰ í•„í„° ë‹¤ì‹œ ì ìš©
                if (currentSearch) {
                    searchInput.value = currentSearch;
                    searchMissingPersons();  // ê²€ìƒ‰ í•„í„° ì¬ì ìš©
                }
                
                const person = this.persons.find(p => p.id === personId);
                if (person) {
                    this.showToast(`ì„ íƒë¨: ${person.name || 'ì´ë¦„ ë¯¸ìƒ'}`, 'success');
                    
                    this.updateSearchRadiusInfo(person);
                    this.updateDriversInRangeInfo(person);
                    
                    if (this.map) {
                        let lat = person.lat;
                        let lng = person.lng;
                        
                        if (!lat || !lng || (lat === 36.5 && lng === 127.8)) {
                            if (person.location && this.geocoder) {
                                try {
                                    const coord = await this.geocodeAddress(person.location);
                                    lat = coord.lat;
                                    lng = coord.lng;
                                    
                                    person.lat = lat;
                                    person.lng = lng;
                                } catch (error) {
                                    console.log(`ì§€ì˜¤ì½”ë”© ì‹¤íŒ¨: ${error}`);
                                }
                            }
                        }
                        
                        if (lat && lng && lat !== 36.5 && lng !== 127.8) {
                            const coords = new kakao.maps.LatLng(lat, lng);
                            this.map.setCenter(coords);
                            this.map.setLevel(3);
                        }
                    }
                }
            }
            
            geocodeAddress(address) {
                return new Promise((resolve, reject) => {
                    if (!this.geocoder || !address) {
                        resolve({lat: 36.5, lng: 127.8});
                        return;
                    }
                    
                    this.geocoder.addressSearch(address, (result, status) => {
                        if (status === kakao.maps.services.Status.OK) {
                            resolve({
                                lat: parseFloat(result[0].y),
                                lng: parseFloat(result[0].x)
                            });
                        } else {
                            reject(new Error(`ì§€ì˜¤ì½”ë”© ì‹¤íŒ¨: ${status}`));
                        }
                    });
                });
            }

            updateSearchRadiusInfo(person) {
                const infoDiv = document.getElementById('searchRadiusInfo');
                const radius = this.getSearchRadius(person);
                const description = this.getSearchDescription(person);
                
                infoDiv.innerHTML = `
                    <strong>ìˆ˜ìƒ‰ ë°˜ê²½: ${(radius/1000).toFixed(1)}km</strong><br>
                    ${description}
                `;
            }

            async updateDriversInRangeInfo(person) {
                const infoDiv = document.getElementById('driversInRange');
                infoDiv.innerHTML = 'ë²”ìœ„ ë‚´ ê¸°ì‚¬ ìˆ˜ë¥¼ ê³„ì‚° ì¤‘...';
                
                const driversInRange = await this.getDriversInRange(person.id);
                
                infoDiv.innerHTML = `
                    <strong>ë²”ìœ„ ë‚´ ì˜¨ë¼ì¸ ê¸°ì‚¬: ${driversInRange.length}ëª…</strong><br>
                    ${driversInRange.slice(0, 5).map(d => `${d.name}(${this.getDriverTypeName(d.type)})`).join(', ')}${driversInRange.length > 5 ? ` ì™¸ ${driversInRange.length - 5}ëª…` : ''}
                `;
            }
            
            updatePersonSelect() {
                const select = document.getElementById('personSelect');
                const currentValue = select.value;
                
                const options = this.persons.map(person => 
                    `<option value="${person.id}">${person.name || 'ì´ë¦„ ë¯¸ìƒ'} (${person.age || 'ë‚˜ì´ ë¯¸ìƒ'}ì„¸)</option>`
                ).join('');
                
                select.innerHTML = '<option value="">ì‹¤ì¢…ìë¥¼ ì„ íƒí•˜ì„¸ìš”</option>' + options;
                
                if (currentValue) {
                    select.value = currentValue;
                }

                select.addEventListener('change', (e) => {
                    if (e.target.value) {
                        const person = this.persons.find(p => p.id === e.target.value);
                        if (person) {
                            this.updateSearchRadiusInfo(person);
                            this.updateDriversInRangeInfo(person);
                        }
                    }
                });
            }
            
            addActivity(activity) {
                const container = document.getElementById('activityLog');
                const activityHtml = `
                    <div class="activity-item">
                        <div class="activity-time">${activity.time}</div>
                        <div class="activity-content">${activity.content}</div>
                    </div>
                `;
                
                container.insertAdjacentHTML('afterbegin', activityHtml);
                
                const items = container.querySelectorAll('.activity-item');
                if (items.length > 50) {
                    items[items.length - 1].remove();
                }
            }
            
            async updateStats() {
                try {
                    document.getElementById('totalActive').textContent = this.persons.length;
                    document.getElementById('highPriority').textContent = this.persons.filter(p => p.priority === 'HIGH').length;
                    document.getElementById('onlineDrivers').textContent = this.drivers.filter(d => d.status === 'online').length;
                    document.getElementById('firebaseStatus').textContent = this.isConnected ? 'ì—°ê²°ë¨' : 'ì—°ê²°ëŠê¹€';
                } catch (error) {
                    console.error('í†µê³„ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨:', error);
                }
            }
            
            initEventListeners() {
                const form = document.getElementById('notificationForm');
                form.addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.sendManualNotification();
                });
                
                const driverForm = document.getElementById('driverForm');
                driverForm.addEventListener('submit', (e) => {
                    e.preventDefault();
                    registerDriver();
                });
            }
            
            async sendManualNotification() {
                const personId = document.getElementById('personSelect').value;
                const notificationType = document.getElementById('notificationType').value;
                
                if (!personId) {
                    this.showToast('ì‹¤ì¢…ìë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.', 'error');
                    return;
                }
                
                const person = this.persons.find(p => p.id === personId);
                if (!person) {
                    this.showToast('ì‹¤ì¢…ì ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.', 'error');
                    return;
                }

                try {
                    this.addActivity({
                        time: new Date().toLocaleTimeString(),
                        content: `ì‹¤ì¢…ì ${person.name || 'ì´ë¦„ ë¯¸ìƒ'} ì•Œë¦¼ ì „ì†¡ ì¤‘...`
                    });

                    const response = await fetch(`${API_BASE_URL}/api/send_notification`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            person: person,
                            target_tokens: ['test_token'],
                            test_mode: notificationType === 'test'
                        })
                    });

                    const result = await response.json();

                    if (response.ok) {
                        this.showToast(`ì•Œë¦¼ ì „ì†¡ ì™„ë£Œ`, 'success');
                        this.showResult('ì•Œë¦¼ ì „ì†¡ ê²°ê³¼', {
                            person: person.name,
                            category: person.category,
                            search_radius: `${(this.getSearchRadius(person)/1000).toFixed(1)}km`,
                            type: notificationType
                        });
                    } else {
                        this.showToast(`ì „ì†¡ ì‹¤íŒ¨: ${result.detail}`, 'error');
                    }

                } catch (error) {
                    this.showToast(`ì˜¤ë¥˜ ë°œìƒ: ${error.message}`, 'error');
                }
            }
            
            showToast(message, type = 'success') {
                const toast = document.createElement('div');
                toast.className = `toast ${type === 'error' ? 'error' : ''}`;
                toast.textContent = message;
                
                document.body.appendChild(toast);
                
                setTimeout(() => toast.classList.add('show'), 100);
                setTimeout(() => {
                    toast.classList.remove('show');
                    setTimeout(() => toast.remove(), 300);
                }, 3000);
            }
            
            showResult(title, data) {
                const resultDiv = document.getElementById('testResults');
                resultDiv.style.display = 'block';
                resultDiv.innerHTML = `${title}:\n${JSON.stringify(data, null, 2)}`;
                
                setTimeout(() => {
                    resultDiv.style.display = 'none';
                }, 10000);
            }

            getDriverTypeName(type) {
                const types = {
                    'taxi': 'íƒì‹œ',
                    'delivery': 'ë°°ë‹¬'
                };
                return types[type] || type;
            }
        }
        
        let admin;
        
        async function testAPI() {
            const btn = event.target;
            btn.classList.add('loading');
            btn.textContent = 'í…ŒìŠ¤íŠ¸ ì¤‘...';
            
            try {
                const response = await fetch(`${API_BASE_URL}/api/missing_persons`);
                const data = await response.json();
                admin.showResult('API í…ŒìŠ¤íŠ¸ ê²°ê³¼', data);
                admin.showToast('API í…ŒìŠ¤íŠ¸ ì„±ê³µ', 'success');
            } catch (error) {
                admin.showToast(`API í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨: ${error.message}`, 'error');
            } finally {
                btn.classList.remove('loading');
                btn.textContent = 'API í…ŒìŠ¤íŠ¸';
            }
        }
        
        async function testFirebase() {
            const btn = event.target;
            btn.classList.add('loading');
            btn.textContent = 'í…ŒìŠ¤íŠ¸ ì¤‘...';
            
            try {
                const response = await fetch(`${API_BASE_URL}/api/send_notification`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        person: {
                            id: 'test_001',
                            name: 'í…ŒìŠ¤íŠ¸ ì‹¤ì¢…ì',
                            age: 30,
                            priority: 'HIGH',
                            location: 'í…ŒìŠ¤íŠ¸ ìœ„ì¹˜'
                        },
                        target_tokens: ['test_token'],
                        test_mode: true
                    })
                });
                
                const result = await response.json();
                admin.showResult('Firebase í…ŒìŠ¤íŠ¸ ê²°ê³¼', result);
                admin.showToast('Firebase í…ŒìŠ¤íŠ¸ ì™„ë£Œ', 'success');
            } catch (error) {
                admin.showToast(`Firebase í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨: ${error.message}`, 'error');
            } finally {
                btn.classList.remove('loading');
                btn.textContent = 'Firebase í…ŒìŠ¤íŠ¸';
            }
        }
        
        async function testTokens() {
            const btn = event.target;
            btn.classList.add('loading');
            btn.textContent = 'í™•ì¸ ì¤‘...';
            
            try {
                const response = await fetch(`${API_BASE_URL}/api/test_tokens`);
                const data = await response.json();
                admin.showResult('í…ŒìŠ¤íŠ¸ í† í° ëª©ë¡', data);
                admin.showToast('í† í° ëª©ë¡ ì¡°íšŒ ì™„ë£Œ', 'success');
            } catch (error) {
                admin.showToast(`í† í° ì¡°íšŒ ì‹¤íŒ¨: ${error.message}`, 'error');
            } finally {
                btn.classList.remove('loading');
                btn.textContent = 'í† í° ëª©ë¡';
            }
        }
        
        async function testStatistics() {
            const btn = event.target;
            btn.classList.add('loading');
            btn.textContent = 'í™•ì¸ ì¤‘...';
            
            try {
                const response = await fetch(`${API_BASE_URL}/api/statistics`);
                const data = await response.json();
                admin.showResult('ì‹œìŠ¤í…œ í†µê³„', data);
                admin.showToast('í†µê³„ ì¡°íšŒ ì™„ë£Œ', 'success');
            } catch (error) {
                admin.showToast(`í†µê³„ ì¡°íšŒ ì‹¤íŒ¨: ${error.message}`, 'error');
            } finally {
                btn.classList.remove('loading');
                btn.textContent = 'í†µê³„ í™•ì¸';
            }
        }
        
        async function createTestToken() {
            const btn = event.target;
            btn.classList.add('loading');
            btn.textContent = 'ìƒì„± ì¤‘...';
            
            try {
                const response = await fetch(`${API_BASE_URL}/api/register_test_token`, {
                    method: 'POST'
                });
                const data = await response.json();
                admin.showResult('í…ŒìŠ¤íŠ¸ í† í° ìƒì„± ê²°ê³¼', data);
                admin.showToast('í…ŒìŠ¤íŠ¸ í† í° ìƒì„± ì™„ë£Œ', 'success');
            } catch (error) {
                admin.showToast(`í† í° ìƒì„± ì‹¤íŒ¨: ${error.message}`, 'error');
            } finally {
                btn.classList.remove('loading');
                btn.textContent = 'í…ŒìŠ¤íŠ¸ í† í° ìƒì„±';
            }
        }
        
        async function forceUpdate() {
            const btn = event.target;
            btn.classList.add('loading');
            btn.textContent = 'ì—…ë°ì´íŠ¸ ì¤‘...';
            
            try {
                const response = await fetch(`${API_BASE_URL}/api/force_update`, {
                    method: 'POST'
                });
                const data = await response.json();
                admin.showResult('ìˆ˜ë™ ì—…ë°ì´íŠ¸ ê²°ê³¼', data);
                admin.showToast('ìˆ˜ë™ ì—…ë°ì´íŠ¸ ì™„ë£Œ', 'success');
                
                await admin.loadInitialData();
            } catch (error) {
                admin.showToast(`ìˆ˜ë™ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨: ${error.message}`, 'error');
            } finally {
                btn.classList.remove('loading');
                btn.textContent = 'ìˆ˜ë™ ì—…ë°ì´íŠ¸';
            }
        }
        
        async function checkNERServer() {
            const btn = event.target;
            btn.classList.add('loading');
            btn.textContent = 'í™•ì¸ ì¤‘...';
            
            try {
                const response = await fetch(`${NER_API_URL}/api/health`);
                const data = await response.json();
                admin.showResult('NER ì„œë²„ ìƒíƒœ', data);
                admin.showToast('NER ì„œë²„ ì—°ê²° í™•ì¸ë¨', 'success');
            } catch (error) {
                admin.showToast(`NER ì„œë²„ ì—°ê²° ì‹¤íŒ¨: ${error.message}`, 'error');
                admin.showResult('NER ì„œë²„ ì˜¤ë¥˜', { error: error.message, note: 'ner_server.pyë¥¼ ë¨¼ì € ì‹¤í–‰í•´ì£¼ì„¸ìš” (í¬íŠ¸ 8000)' });
            } finally {
                btn.classList.remove('loading');
                btn.textContent = 'NER ì„œë²„ í™•ì¸';
            }
        }
        
        function initKakaoMap() {
            admin.initializeKakaoMap();
        }
        
        window.onload = () => {
            admin = new AdminDashboard();
        };

        // ëŒ€ê¸° ì¤‘ì¸ ì‹ ê³  ëª©ë¡ ë¡œë“œ
        async function loadPendingReports() {
            try {
                const response = await fetch(`${API_BASE_URL}/api/pending_reports`);
                const data = await response.json();
                
                document.getElementById('pendingReportsCount').textContent = data.count || 0;
                
                const container = document.getElementById('pendingReportsList');
                
                if (!data.reports || data.reports.length === 0) {
                    container.innerHTML = '<div style="text-align: center; padding: 2rem; color: #9ca3af;">ëŒ€ê¸° ì¤‘ì¸ ì‹ ê³ ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
                    return;
                }
                
                const html = data.reports.map(report => `
                    <div class="person-card" style="border-left: 4px solid #f59e0b;">
                        <div style="display: flex; gap: 1rem;">
                            ${report.photo_base64 ? `
                                <img src="${report.photo_base64}" 
                                     style="width: 80px; height: 80px; border-radius: 8px; object-fit: cover;">
                            ` : `
                                <div style="width: 80px; height: 80px; background: #f3f4f6; border-radius: 8px; 
                                            display: flex; align-items: center; justify-content: center;">
                                    <span style="font-size: 2rem;">ğŸ‘¤</span>
                                </div>
                            `}
                            
                            <div style="flex: 1;">
                                <h3 style="font-size: 1.1rem; font-weight: 600; margin-bottom: 0.5rem;">
                                    ${report.name || 'ì´ë¦„ ë¯¸ìƒ'}
                                </h3>
                                <div style="display: flex; gap: 0.5rem; margin-bottom: 0.5rem;">
                                    <span class="person-badge">${report.age || '?'}ì„¸</span>
                                    <span class="person-badge">${report.gender || '?'}</span>
                                    <span class="person-badge category-badge">${report.category || 'ê¸°íƒ€'}</span>
                                </div>
                                <p style="font-size: 0.9rem; color: #6b7280; margin-bottom: 0.5rem;">
                                    <strong>ì‹¤ì¢… ì¥ì†Œ:</strong> ${report.location || 'ì •ë³´ ì—†ìŒ'}
                                </p>
                                <p style="font-size: 0.9rem; color: #6b7280; margin-bottom: 0.5rem;">
                                    <strong>ì‹¤ì¢… ì‹œê°:</strong> ${formatDateTime(report.last_seen)}
                                </p>
                                <p style="font-size: 0.9rem; color: #6b7280; margin-bottom: 0.5rem;">
                                    <strong>ì‹ ê³  ì ‘ìˆ˜:</strong> ${formatDateTime(report.created_at)}
                                </p>
                                ${report.emergency_contact ? `
                                    <p style="font-size: 0.9rem; color: #6b7280; margin-bottom: 0.5rem;">
                                        <strong>ì—°ë½ì²˜:</strong> ${report.emergency_contact}
                                    </p>
                                ` : ''}
                                ${report.description ? `
                                    <p style="font-size: 0.9rem; color: #6b7280; margin-top: 0.5rem;">
                                        ${report.description}
                                    </p>
                                ` : ''}
                            </div>
                        </div>
                        
                        <div style="display: flex; gap: 0.5rem; margin-top: 1rem;">
                            <button class="btn btn-primary" onclick="approveReport('${report.id}')" style="flex: 1;">
                                ìŠ¹ì¸
                            </button>
                            <button class="btn" onclick="rejectReport('${report.id}')" 
                                    style="flex: 1; background: #ef4444; color: white;">
                                ê±°ì ˆ
                            </button>
                            <button class="btn btn-secondary" onclick="showReportDetail('${report.id}')">
                                ìƒì„¸
                            </button>
                        </div>
                    </div>
                `).join('');
                
                container.innerHTML = html;
                
            } catch (error) {
                console.error('ëŒ€ê¸° ì‹ ê³  ë¡œë“œ ì‹¤íŒ¨:', error);
                admin.showToast('ì‹ ê³  ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤', 'error');
            }
        }

        // ì‹ ê³  ìŠ¹ì¸
        async function approveReport(reportId) {
            if (!confirm('ì´ ì‹¤ì¢…ì ì‹ ê³ ë¥¼ ìŠ¹ì¸í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                return;
            }
            
            try {
                const response = await fetch(`${API_BASE_URL}/api/missing_persons/${reportId}/approve`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'}
                });
                
                if (response.ok) {
                    admin.showToast('ì‹ ê³ ê°€ ìŠ¹ì¸ë˜ì—ˆìŠµë‹ˆë‹¤', 'success');
                    admin.addActivity({
                        time: new Date().toLocaleTimeString(),
                        content: `ì‹¤ì¢…ì ì‹ ê³  ìŠ¹ì¸`
                    });
                    await loadPendingReports();
                    await loadApprovedPersons();
                } else {
                    admin.showToast('ìŠ¹ì¸ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤', 'error');
                }
            } catch (error) {
                console.error('ìŠ¹ì¸ ì˜¤ë¥˜:', error);
                admin.showToast('ìŠ¹ì¸ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤', 'error');
            }
        }

        // ì‹ ê³  ê±°ì ˆ
        async function rejectReport(reportId) {
            const reason = prompt('ê±°ì ˆ ì‚¬ìœ ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”:');
            if (!reason) {
                return;
            }
            
            try {
                const response = await fetch(`${API_BASE_URL}/api/missing_persons/${reportId}/reject`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(reason)
                });
                
                if (response.ok) {
                    admin.showToast('ì‹ ê³ ê°€ ê±°ì ˆë˜ì—ˆìŠµë‹ˆë‹¤', 'success');
                    admin.addActivity({
                        time: new Date().toLocaleTimeString(),
                        content: `ì‹¤ì¢…ì ì‹ ê³  ê±°ì ˆ`
                    });
                    await loadPendingReports();
                } else {
                    admin.showToast('ê±°ì ˆì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤', 'error');
                }
            } catch (error) {
                console.error('ê±°ì ˆ ì˜¤ë¥˜:', error);
                admin.showToast('ê±°ì ˆ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤', 'error');
            }
        }

        // ìŠ¹ì¸ëœ ì‹¤ì¢…ì ëª©ë¡ ë¡œë“œ
        async function loadApprovedPersons() {
            try {
                const response = await fetch(`${API_BASE_URL}/api/missing_persons`);
                const data = await response.json();
                
                const container = document.getElementById('approvedPersonsList');
                
                if (!container) {
                    console.error('approvedPersonsList ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
                    return;
                }
                
                if (!data.persons || data.persons.length === 0) {
                    container.innerHTML = '<div style="text-align: center; padding: 2rem; color: #9ca3af;">ìŠ¹ì¸ëœ ì‹¤ì¢…ìê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
                    return;
                }
                
                const html = data.persons.map(person => `
                    <div class="person-card" style="border-left: 4px solid #10b981; margin-bottom: 0.75rem;">
                        <div style="display: flex; gap: 1rem; align-items: start;">
                            ${person.photo_url || person.photo_base64 ? `
                                <img src="${person.photo_url || person.photo_base64}" 
                                    style="width: 60px; height: 60px; border-radius: 8px; object-fit: cover;">
                            ` : `
                                <div style="width: 60px; height: 60px; background: #f3f4f6; border-radius: 8px; 
                                            display: flex; align-items: center; justify-content: center;">
                                    <span style="font-size: 1.5rem;">ğŸ‘¤</span>
                                </div>
                            `}
                            
                            <div style="flex: 1;">
                                <h4 style="font-size: 1rem; font-weight: 600; margin-bottom: 0.3rem;">
                                    ${person.name || 'ì´ë¦„ ë¯¸ìƒ'}
                                </h4>
                                <div style="display: flex; gap: 0.3rem; margin-bottom: 0.3rem; flex-wrap: wrap;">
                                    <span class="person-badge" style="font-size: 0.75rem;">${person.age || '?'}ì„¸</span>
                                    <span class="person-badge" style="font-size: 0.75rem;">${person.gender || '?'}</span>
                                    <span class="person-badge category-badge" style="font-size: 0.75rem;">${person.category || 'ê¸°íƒ€'}</span>
                                    ${person.source === 'REPORTER' ? 
                                        '<span class="person-badge" style="font-size: 0.75rem; background: #3b82f6; color: white;">ì‹ ê³ </span>' : 
                                        '<span class="person-badge" style="font-size: 0.75rem; background: #8b5cf6; color: white;">API</span>'}
                                </div>
                                <p style="font-size: 0.85rem; color: #6b7280;">
                                    ${person.location || 'ìœ„ì¹˜ ì •ë³´ ì—†ìŒ'}
                                </p>
                            </div>
                            
                            <button class="btn" onclick="event.stopPropagation(); deletePerson('${person.id}')" 
                                    style="background: #ef4444; color: white; padding: 0.5rem 1rem; font-size: 0.875rem; 
                                        border: none; border-radius: 6px; cursor: pointer; white-space: nowrap;">
                                ì‚­ì œ
                            </button>
                        </div>
                    </div>
                `).join('');
                
                container.innerHTML = html;
                
                console.log(`ìŠ¹ì¸ëœ ì‹¤ì¢…ì ${data.persons.length}ëª… í‘œì‹œë¨`);
                
            } catch (error) {
                console.error('ìŠ¹ì¸ëœ ì‹¤ì¢…ì ë¡œë“œ ì‹¤íŒ¨:', error);
                const container = document.getElementById('approvedPersonsList');
                if (container) {
                    container.innerHTML = '<div style="text-align: center; padding: 2rem; color: #ef4444;">ì‹¤ì¢…ì ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</div>';
                }
            }
        }

        // ì‹¤ì¢…ì ì‚­ì œ
        async function deletePerson(personId) {
            if (!confirm('ì´ ì‹¤ì¢…ìë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ? ì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.')) {
                return;
            }
            
            try {
                const response = await fetch(`${API_BASE_URL}/api/missing_persons/${personId}`, {
                    method: 'DELETE'
                });
                
                if (response.ok) {
                    admin.showToast('ì‹¤ì¢…ìê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤', 'success');
                    admin.addActivity({
                        time: new Date().toLocaleTimeString(),
                        content: `ì‹¤ì¢…ì ì‚­ì œ`
                    });
                    
                    // ëª©ë¡ ìƒˆë¡œê³ ì¹¨
                    await loadApprovedPersons();
                    await admin.loadInitialData();
                } else {
                    const error = await response.json();
                    admin.showToast(`ì‚­ì œ ì‹¤íŒ¨: ${error.detail || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'}`, 'error');
                }
            } catch (error) {
                console.error('ì‚­ì œ ì˜¤ë¥˜:', error);
                admin.showToast('ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤', 'error');
            }
        }

        // ì‹¤ì¢…ì ê²€ìƒ‰
        function searchApprovedPersons() {
            const searchTerm = document.getElementById('approvedPersonSearch').value.toLowerCase();
            const cards = document.querySelectorAll('#approvedPersonsList .person-card');
            
            cards.forEach(card => {
                const name = card.querySelector('h4').textContent.toLowerCase();
                if (name.includes(searchTerm)) {
                    card.style.display = 'block';
                } else {
                    card.style.display = 'none';
                }
            });
        }

        // ë‚ ì§œ í¬ë§· í•¨ìˆ˜
        function formatDateTime(dateString) {
            if (!dateString) return 'ì •ë³´ ì—†ìŒ';
            try {
                const date = new Date(dateString);
                return `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}-${String(date.getDate()).padStart(2, '0')} ${String(date.getHours()).padStart(2, '0')}:${String(date.getMinutes()).padStart(2, '0')}`;
            } catch {
                return dateString;
            }
        }

        // ì‹ ê³  ìƒì„¸ ë³´ê¸°
        async function showReportDetail(reportId) {
            showPersonDetail(reportId);
        }

        // ì‹¤ì¢…ì ê²€ìƒ‰ í•¨ìˆ˜
        function searchMissingPersons() {
            const searchTerm = document.getElementById('missingPersonSearch').value.toLowerCase();
            const personCards = document.querySelectorAll('#personList .person-item');
            
            let visibleCount = 0;
            
            personCards.forEach(card => {
                // .person-name í´ë˜ìŠ¤ë¥¼ ê°€ì§„ ìš”ì†Œì—ì„œ ì´ë¦„ ì¶”ì¶œ
                const nameElement = card.querySelector('.person-name');
                
                if (nameElement) {
                    const nameText = nameElement.textContent.toLowerCase();
                    
                    // ê²€ìƒ‰ì–´ê°€ ì´ë¦„ì— í¬í•¨ë˜ì–´ ìˆìœ¼ë©´ í‘œì‹œ
                    if (nameText.includes(searchTerm)) {
                        card.style.display = 'flex';  // person-itemì€ flex ë ˆì´ì•„ì›ƒ ì‚¬ìš©
                        visibleCount++;
                    } else {
                        card.style.display = 'none';
                    }
                }
            });
            
            // ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ì„ ë•Œ ë©”ì‹œì§€ í‘œì‹œ (ì„ íƒì‚¬í•­)
            const container = document.getElementById('personList');
            let noResultsMsg = container.querySelector('.no-results-message');
            
            if (visibleCount === 0 && searchTerm.length > 0) {
                if (!noResultsMsg) {
                    noResultsMsg = document.createElement('div');
                    noResultsMsg.className = 'no-results-message';
                    noResultsMsg.style.cssText = 'text-align: center; padding: 2rem; color: #9ca3af;';
                    noResultsMsg.textContent = 'ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.';
                    container.appendChild(noResultsMsg);
                }
                noResultsMsg.style.display = 'block';
            } else if (noResultsMsg) {
                noResultsMsg.style.display = 'none';
            }
            
            console.log(`ê²€ìƒ‰ ê²°ê³¼: "${searchTerm}" - ${visibleCount}ëª… í‘œì‹œ`);
        }
    </script>
</body>
</html>